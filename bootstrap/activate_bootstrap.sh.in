#!/bin/bash
# LMGC90 Bootstrap Environment Activation Script
# Generated by CMake bootstrap system

# Bootstrap installation prefix
export BOOTSTRAP_PREFIX="@BOOTSTRAP_PREFIX@"

# Add GCC toolchain to PATH
export PATH="${BOOTSTRAP_PREFIX}/gcc/bin:${PATH}"

# Add other tools to PATH
export PATH="${BOOTSTRAP_PREFIX}/bin:${PATH}"

# Library paths
export LD_LIBRARY_PATH="${BOOTSTRAP_PREFIX}/lib:${BOOTSTRAP_PREFIX}/gcc/lib64:${LD_LIBRARY_PATH}"
export DYLD_LIBRARY_PATH="${BOOTSTRAP_PREFIX}/lib:${BOOTSTRAP_PREFIX}/gcc/lib:${DYLD_LIBRARY_PATH}"

# Compiler environment variables
export CC="${BOOTSTRAP_PREFIX}/gcc/bin/gcc"
export CXX="${BOOTSTRAP_PREFIX}/gcc/bin/g++"
export FC="${BOOTSTRAP_PREFIX}/gcc/bin/gfortran"
export F77="${BOOTSTRAP_PREFIX}/gcc/bin/gfortran"

# CMake prefix path for finding packages
export CMAKE_PREFIX_PATH="${BOOTSTRAP_PREFIX}:${CMAKE_PREFIX_PATH}"

# PKG_CONFIG_PATH for package discovery
export PKG_CONFIG_PATH="${BOOTSTRAP_PREFIX}/lib/pkgconfig:${PKG_CONFIG_PATH}"

# HDF5 specific environment
export HDF5_ROOT="${BOOTSTRAP_PREFIX}"
export HDF5_DIR="${BOOTSTRAP_PREFIX}"

# OpenBLAS/BLAS environment
export BLAS_ROOT="${BOOTSTRAP_PREFIX}"
export LAPACK_ROOT="${BOOTSTRAP_PREFIX}"

# SWIG environment
export SWIG_EXECUTABLE="${BOOTSTRAP_PREFIX}/bin/swig"

# Python user site packages (for --user installs)
if [[ -n "$PYTHONPATH" ]]; then
    export PYTHONPATH="$(python3 -m site --user-site):${PYTHONPATH}"
else
    export PYTHONPATH="$(python3 -m site --user-site)"
fi

# Visual feedback
echo "ðŸš€ LMGC90 Bootstrap Environment Activated!"
echo ""
echo "Toolchain Information:"
echo "  GCC:      $(${CC} --version | head -n1)"
echo "  G++:      $(${CXX} --version | head -n1)"
echo "  GFortran: $(${FC} --version | head -n1)"
echo "  SWIG:     $(${SWIG_EXECUTABLE} -version | head -n2 | tail -n1)"
echo "  HDF5:     ${HDF5_ROOT}"
echo "  BLAS:     ${BLAS_ROOT}"
echo ""
echo "Environment ready for LMGC90 compilation!"
echo "Next: cd to LMGC90 source and run:"
echo "  mkdir build && cd build"
echo "  cmake -DCMAKE_TOOLCHAIN_FILE=@CMAKE_BINARY_DIR@/lmgc90_toolchain.cmake .."
echo "  make -j@BOOTSTRAP_BUILD_JOBS@"
echo ""

# Function to deactivate environment
deactivate_bootstrap() {
    # Remove bootstrap paths from PATH
    export PATH=$(echo $PATH | tr ':' '\n' | grep -v "${BOOTSTRAP_PREFIX}" | tr '\n' ':' | sed 's/:$//')
    
    # Unset environment variables
    unset CC CXX FC F77
    unset HDF5_ROOT HDF5_DIR
    unset BLAS_ROOT LAPACK_ROOT
    unset SWIG_EXECUTABLE
    unset BOOTSTRAP_PREFIX
    
    # Remove function
    unset -f deactivate_bootstrap
    
    echo "ðŸ”„ LMGC90 Bootstrap Environment Deactivated"
}

echo "To deactivate this environment, run: deactivate_bootstrap"
