# LMGC90 CMake Toolchain File
# Generated by CMake bootstrap system
# This file configures CMake to use the bootstrapped dependencies

set(CMAKE_SYSTEM_NAME @CMAKE_SYSTEM_NAME@)
set(CMAKE_SYSTEM_PROCESSOR @CMAKE_SYSTEM_PROCESSOR@)

# Bootstrap installation prefix
set(BOOTSTRAP_PREFIX "@BOOTSTRAP_PREFIX@")

# Compiler configuration
set(CMAKE_C_COMPILER "${BOOTSTRAP_PREFIX}/gcc/bin/gcc")
set(CMAKE_CXX_COMPILER "${BOOTSTRAP_PREFIX}/gcc/bin/g++")
set(CMAKE_Fortran_COMPILER "${BOOTSTRAP_PREFIX}/gcc/bin/gfortran")

# Compiler flags for compatibility
set(CMAKE_C_FLAGS_INIT "-fPIC")
set(CMAKE_CXX_FLAGS_INIT "-fPIC -std=c++17")
set(CMAKE_Fortran_FLAGS_INIT "-fPIC")

# Search paths for libraries and includes
set(CMAKE_FIND_ROOT_PATH "${BOOTSTRAP_PREFIX}")
set(CMAKE_PREFIX_PATH "${BOOTSTRAP_PREFIX}")

# Search for programs in the build host directories
set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
# Search for libraries and headers in the target directories
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)

# HDF5 configuration
set(HDF5_ROOT "${BOOTSTRAP_PREFIX}")
set(HDF5_DIR "${BOOTSTRAP_PREFIX}/share/cmake/hdf5")
set(HDF5_PREFER_PARALLEL OFF)

# BLAS/LAPACK configuration
set(BLA_VENDOR OpenBLAS)
set(BLAS_ROOT "${BOOTSTRAP_PREFIX}")
set(LAPACK_ROOT "${BOOTSTRAP_PREFIX}")

# SWIG configuration
set(SWIG_EXECUTABLE "${BOOTSTRAP_PREFIX}/bin/swig")
set(SWIG_DIR "${BOOTSTRAP_PREFIX}/share/swig/3.0.12")

# Python configuration
find_program(PYTHON_EXECUTABLE python3 REQUIRED)
set(Python_EXECUTABLE ${PYTHON_EXECUTABLE})
set(Python3_EXECUTABLE ${PYTHON_EXECUTABLE})

# Library search paths
set(CMAKE_LIBRARY_PATH 
    "${BOOTSTRAP_PREFIX}/lib"
    "${BOOTSTRAP_PREFIX}/gcc/lib64"
    "${BOOTSTRAP_PREFIX}/gcc/lib"
)

# Include search paths
set(CMAKE_INCLUDE_PATH
    "${BOOTSTRAP_PREFIX}/include"
    "${BOOTSTRAP_PREFIX}/gcc/include"
)

# Linker flags
set(CMAKE_EXE_LINKER_FLAGS_INIT "-L${BOOTSTRAP_PREFIX}/lib -L${BOOTSTRAP_PREFIX}/gcc/lib64")
set(CMAKE_SHARED_LINKER_FLAGS_INIT "-L${BOOTSTRAP_PREFIX}/lib -L${BOOTSTRAP_PREFIX}/gcc/lib64")

# RPATH settings for runtime library discovery
set(CMAKE_INSTALL_RPATH "${BOOTSTRAP_PREFIX}/lib;${BOOTSTRAP_PREFIX}/gcc/lib64")
set(CMAKE_BUILD_RPATH "${BOOTSTRAP_PREFIX}/lib;${BOOTSTRAP_PREFIX}/gcc/lib64")
set(CMAKE_INSTALL_RPATH_USE_LINK_PATH TRUE)

# Ensure we use the bootstrapped tools
set(CMAKE_MAKE_PROGRAM make)

# Additional hints for package finding
set(ENV{PKG_CONFIG_PATH} "${BOOTSTRAP_PREFIX}/lib/pkgconfig:$ENV{PKG_CONFIG_PATH}")

# LMGC90 specific configurations
set(WITH_HDF5 ON CACHE BOOL "Enable HDF5 support")
set(WITH_OPENMP ON CACHE BOOL "Enable OpenMP support")
set(WITH_PYTHON ON CACHE BOOL "Enable Python bindings")

# Ensure Python bindings use the correct SWIG version
set(CMAKE_SWIG_FLAGS "-I${BOOTSTRAP_PREFIX}/include")

message(STATUS "LMGC90 Toolchain: Using bootstrapped dependencies from ${BOOTSTRAP_PREFIX}")
message(STATUS "LMGC90 Toolchain: C Compiler = ${CMAKE_C_COMPILER}")
message(STATUS "LMGC90 Toolchain: CXX Compiler = ${CMAKE_CXX_COMPILER}")
message(STATUS "LMGC90 Toolchain: Fortran Compiler = ${CMAKE_Fortran_COMPILER}")
message(STATUS "LMGC90 Toolchain: SWIG = ${SWIG_EXECUTABLE}")
message(STATUS "LMGC90 Toolchain: Python = ${PYTHON_EXECUTABLE}")
message(STATUS "LMGC90 Toolchain: HDF5 Root = ${HDF5_ROOT}")
message(STATUS "LMGC90 Toolchain: BLAS Root = ${BLAS_ROOT}")
