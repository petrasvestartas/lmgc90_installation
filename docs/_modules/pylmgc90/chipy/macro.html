
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pylmgc90.chipy.macro &#8212; pylmgc90 2025.rc1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pylmgc90 2025.rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pylmgc90.chipy.macro</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylmgc90.chipy.macro</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># this is necessary because swig generate</span>
<span class="c1"># a shared library with &quot;local symbols&quot;</span>
<span class="c1"># but sometimes MPI library may not be able</span>
<span class="c1"># to handle them, thus this do the trick</span>
<span class="k">try</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">dl</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">setdlopenflags</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">RTLD_NOW</span><span class="o">|</span><span class="n">dl</span><span class="o">.</span><span class="n">RTLD_GLOBAL</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.lmgc90</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.preconW</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.ddm_utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">config</span>

<span class="kn">from</span> <span class="nn">.vtk_select</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">..post</span> <span class="kn">import</span> <span class="n">central_kernel</span>

<span class="n">DIMENSION</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># for new display</span>
<span class="n">wdf</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">dict_fid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dict_fgp</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fvtk</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">vblock_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># some mappers</span>
<span class="n">get_mdl</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">get_tac</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">get_sta</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">get_int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">int_id</span>  <span class="o">=</span> <span class="kc">None</span>

<span class="n">inters_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">inter_dtype</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">inter_itype</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># for registering internals of interaction</span>
<span class="n">inter_mapper</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">registers2display</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># to store if hdf5 use</span>
<span class="n">use_hdf5</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SetDimension"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SetDimension">[docs]</a><span class="k">def</span> <span class="nf">SetDimension</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set dimension of the simulation and</span>
<span class="sd">  type of simulation.</span>

<span class="sd">  possible values of mod:</span>

<span class="sd">  - 1 for PSTRAIN</span>
<span class="sd">  - 2 for PSTRESS</span>
<span class="sd">  - 3 for AXI</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">inters_list</span><span class="p">,</span> <span class="n">inter_dtype</span><span class="p">,</span> <span class="n">inter_itype</span>

  <span class="n">DIMENSION</span> <span class="o">=</span> <span class="n">dim</span>
  <span class="n">overall_DIME</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="n">mod</span><span class="p">)</span>

  <span class="n">FIELDS2TYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inter&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;icdan&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cdbdy&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;icdbdy&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cdtac&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;icdtac&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;anbdy&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;ianbdy&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;antac&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;iantac&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;icdsci&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;iansci&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;behav&#39;</span>    <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;status&#39;</span>   <span class="p">:</span> <span class="s1">&#39;S5&#39;</span><span class="p">,</span> <span class="s1">&#39;nb_int&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;rl&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                 <span class="s1">&#39;vl&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                 <span class="s1">&#39;gapTT&#39;</span>    <span class="p">:</span> <span class="s1">&#39;f8&#39;</span>          <span class="p">,</span>
                 <span class="s1">&#39;coor&#39;</span>     <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                 <span class="s1">&#39;uc&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,dim)f8&#39;</span> <span class="p">,</span>
                 <span class="s1">&#39;internals&#39;</span><span class="p">:</span> <span class="s1">&#39;(max_int,)f8&#39;</span><span class="p">,</span>
                <span class="p">}</span>
  <span class="n">FIELDS2ITYPE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;inter&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;icdan&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;cdbdy&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;icdbdy&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;cdtac&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;icdtac&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;anbdy&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;ianbdy&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;antac&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;iantac&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;icdsci&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;iansci&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;behav&#39;</span>    <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;status&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;nb_int&#39;</span>   <span class="p">:</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;rl&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                  <span class="s1">&#39;vl&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                  <span class="s1">&#39;gapTT&#39;</span>    <span class="p">:</span> <span class="s1">&#39;f8&#39;</span>          <span class="p">,</span>
                  <span class="s1">&#39;coor&#39;</span>     <span class="p">:</span> <span class="s1">&#39;(dim,)f8&#39;</span>    <span class="p">,</span>
                  <span class="s1">&#39;uc&#39;</span>       <span class="p">:</span> <span class="s1">&#39;(dim,dim)f8&#39;</span> <span class="p">,</span>
                  <span class="s1">&#39;internals&#39;</span><span class="p">:</span> <span class="s1">&#39;(max_int,)f8&#39;</span><span class="p">,</span>
                 <span class="p">}</span>

  <span class="n">max_int</span> <span class="o">=</span> <span class="n">overall_GetMaxInternalTact</span><span class="p">()</span>

  <span class="n">fields</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FIELDS2TYPE</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">]</span>
  <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;max_int&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">max_int</span><span class="p">))</span>
              <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FIELDS2TYPE</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">]</span>
  <span class="n">inter_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span><span class="n">fields</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span><span class="n">formats</span><span class="p">}</span> <span class="p">)</span>

  <span class="n">fields</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FIELDS2ITYPE</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">]</span>
  <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;dim&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;max_int&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">max_int</span><span class="p">))</span>
              <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FIELDS2ITYPE</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">]</span>
  <span class="n">inter_itype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;names&#39;</span><span class="p">:</span><span class="n">fields</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span><span class="n">formats</span><span class="p">}</span> <span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">inters_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">CLALp_ID</span><span class="p">,</span> <span class="n">CLJCx_ID</span><span class="p">,</span> <span class="n">DKALp_ID</span><span class="p">,</span> <span class="n">DKDKL_ID</span><span class="p">,</span>
                     <span class="n">DKDKx_ID</span><span class="p">,</span> <span class="n">DKJCx_ID</span><span class="p">,</span> <span class="n">DKKDx_ID</span><span class="p">,</span>
                     <span class="n">DKPLx_ID</span><span class="p">,</span> <span class="n">P2P2L_ID</span><span class="p">,</span>
                     <span class="n">PLALp_ID</span><span class="p">,</span> <span class="n">PLJCx_ID</span><span class="p">,</span> <span class="n">PLPLx_ID</span><span class="p">,</span> <span class="n">PTPT2_ID</span><span class="p">]</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">inters_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">CDCDx_ID</span><span class="p">,</span> <span class="n">CDPLx_ID</span><span class="p">,</span> <span class="n">CSASp_ID</span><span class="p">,</span> <span class="n">PRASp_ID</span><span class="p">,</span>
                     <span class="n">CSPRx_ID</span><span class="p">,</span> <span class="n">PRPLx_ID</span><span class="p">,</span> <span class="n">PRPRx_ID</span><span class="p">,</span> <span class="n">PTPT3_ID</span><span class="p">,</span>
                     <span class="n">SPCDx_ID</span><span class="p">,</span> <span class="n">SPDCx_ID</span><span class="p">,</span> <span class="n">SPPLx_ID</span><span class="p">,</span> <span class="n">SPSPx_ID</span><span class="p">,</span>
                     <span class="n">SPPRx_ID</span><span class="p">,</span>
                    <span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;[ERROR:SetDimenion] dim parameter must be 2 or 3, not </span><span class="si">{</span><span class="n">dim</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
      <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="GetDimension"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.GetDimension">[docs]</a><span class="k">def</span> <span class="nf">GetDimension</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Get dimension of the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">return</span> <span class="n">DIMENSION</span></div>

<div class="viewcode-block" id="Initialize"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.Initialize">[docs]</a><span class="k">def</span> <span class="nf">Initialize</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Initialize LMGC90 (and timers).</span>

<span class="sd">  timer_GetNewTimer(xxx) must be called after this function.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">get_mdl</span><span class="p">,</span> <span class="n">get_tac</span><span class="p">,</span> <span class="n">get_sta</span><span class="p">,</span> <span class="n">get_int</span><span class="p">,</span> <span class="n">int_id</span>

  <span class="n">overall_Initialize</span><span class="p">()</span>
  <span class="n">timer_ClearAll</span><span class="p">()</span>
  <span class="n">timer_InitializeTimers</span><span class="p">()</span>

  <span class="n">parameters_checkAll</span><span class="p">()</span>

  <span class="n">parameters</span> <span class="o">=</span>  <span class="p">[</span><span class="s1">&#39;PhysicType&#39;</span>             <span class="p">,</span> <span class="s1">&#39;BodyModel&#39;</span>          <span class="p">,</span> <span class="s1">&#39;Contactor&#39;</span>  <span class="p">,</span>
                 <span class="s1">&#39;Interaction&#39;</span>            <span class="p">,</span> <span class="s1">&#39;MatrixStorage&#39;</span>      <span class="p">,</span> <span class="s1">&#39;MatrixShape&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GeneralizedCoordinates&#39;</span> <span class="p">,</span> <span class="s1">&#39;SurfaceEnergyStatus&#39;</span><span class="p">,</span> <span class="s1">&#39;InterLaw&#39;</span>   <span class="p">,</span>
                 <span class="s1">&#39;Integrator&#39;</span>             <span class="p">,</span> <span class="s1">&#39;Node&#39;</span>               <span class="p">,</span> <span class="s1">&#39;DimeMode&#39;</span>   <span class="p">,</span>
                 <span class="s1">&#39;BodyVector&#39;</span>             <span class="p">,</span> <span class="s1">&#39;ContactStatus&#39;</span>
                <span class="p">]</span>

  <span class="c1"># generate list of parameters</span>
  <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>

    <span class="c1"># get list of names of a parameter type</span>
    <span class="n">param_names</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;parameters_get&#39;</span><span class="o">+</span><span class="n">parameter</span><span class="o">+</span><span class="s1">&#39;Names()&#39;</span><span class="p">)</span>

    <span class="c1"># add each parameters as an attribute of the pylmgc90.chipy module...</span>
    <span class="c1"># and current module !!!</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">:</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">]</span>        <span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_ID&#39;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;parameters_get&#39;</span><span class="o">+</span><span class="n">parameter</span><span class="o">+</span><span class="s1">&#39;Id(&quot;&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">))</span>
      <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s1">&#39;pylmgc90.chipy&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_ID&#39;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;parameters_get&#39;</span><span class="o">+</span><span class="n">parameter</span><span class="o">+</span><span class="s1">&#39;Id(&quot;&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)</span> <span class="p">)</span>

  <span class="n">mdl_id</span>  <span class="o">=</span> <span class="p">{</span><span class="n">parameters_getBodyModelId</span><span class="p">(</span><span class="n">n</span><span class="p">):</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">parameters_getBodyModelNames</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">get_mdl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">mdl_id</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
  <span class="n">tac_id</span>  <span class="o">=</span> <span class="p">{</span><span class="n">parameters_getContactorId</span><span class="p">(</span><span class="n">n</span><span class="p">):</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">parameters_getContactorNames</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">get_tac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">tac_id</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
  <span class="n">sta_id</span>  <span class="o">=</span> <span class="p">{</span><span class="n">parameters_getContactStatusId</span><span class="p">(</span><span class="n">n</span><span class="p">):</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">parameters_getContactStatusNames</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">get_sta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">sta_id</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
  <span class="n">int_id</span>  <span class="o">=</span> <span class="p">{</span><span class="n">parameters_getInteractionId</span><span class="p">(</span><span class="n">n</span><span class="p">):</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">parameters_getInteractionNames</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">get_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">int_id</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
  <span class="n">int_id</span>  <span class="o">=</span> <span class="p">{</span> <span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">():</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">int_id</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">int_id</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">int_id</span><span class="o">.</span><span class="n">get</span><span class="p">)</span></div>


<div class="viewcode-block" id="Finalize"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.Finalize">[docs]</a><span class="k">def</span> <span class="nf">Finalize</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Close LMGC90.</span>

<span class="sd">  If  the --no-finalize option is passed to the python interpretor</span>
<span class="sd">  this function is skipped.</span>

<span class="sd">  This is useful when wanting to use the python interpretor in</span>
<span class="sd">  interactive mode after a computation and check LMGC90 database content.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">wdf</span><span class="p">,</span> <span class="n">dict_fid</span><span class="p">,</span> <span class="n">dict_fgp</span><span class="p">,</span> <span class="n">inters_list</span><span class="p">,</span> <span class="n">fvtk</span><span class="p">,</span> <span class="n">vblock_list</span>
  <span class="k">global</span> <span class="n">inter_mapper</span><span class="p">,</span> <span class="n">registers2display</span>

  <span class="k">if</span> <span class="s1">&#39;--no-finalize&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
    <span class="k">return</span>

  <span class="n">models_CleanMemory</span><span class="p">()</span>
  <span class="n">ExternalModels_CleanMemory</span><span class="p">()</span>
  <span class="n">bulk_behav_CleanMemory</span><span class="p">()</span>
  <span class="n">tact_behav_CleanMemory</span><span class="p">()</span>

  <span class="n">CLALp_CleanMemory</span><span class="p">()</span>
  <span class="n">CSASp_CleanMemory</span><span class="p">()</span>
  <span class="n">PRASp_CleanMemory</span><span class="p">()</span>
  <span class="n">CLJCx_CleanMemory</span><span class="p">()</span>
  <span class="n">DKALp_CleanMemory</span><span class="p">()</span>
  <span class="n">PLALp_CleanMemory</span><span class="p">()</span>
  <span class="n">DKDKL_CleanMemory</span><span class="p">()</span>
  <span class="n">P2P2L_CleanMemory</span><span class="p">()</span>

  <span class="n">CDCDx_CleanMemory</span><span class="p">()</span>
  <span class="n">CDPLx_CleanMemory</span><span class="p">()</span>
  <span class="n">CSPRx_CleanMemory</span><span class="p">()</span>
  <span class="n">PRPLx_CleanMemory</span><span class="p">()</span>
  <span class="n">PRPRx_CleanMemory</span><span class="p">()</span>
  <span class="n">PTPT3_CleanMemory</span><span class="p">()</span>
  <span class="n">SPCDx_CleanMemory</span><span class="p">()</span>
  <span class="n">SPDCx_CleanMemory</span><span class="p">()</span>
  <span class="n">SPPLx_CleanMemory</span><span class="p">()</span>
  <span class="n">SPPRx_CleanMemory</span><span class="p">()</span>
  <span class="n">SPSPx_CleanMemory</span><span class="p">()</span>

  <span class="n">DKDKx_CleanMemory</span><span class="p">()</span>
  <span class="n">DKJCx_CleanMemory</span><span class="p">()</span>
  <span class="n">DKKDx_CleanMemory</span><span class="p">()</span>
  <span class="n">DKPLx_CleanMemory</span><span class="p">()</span>
  <span class="n">PLJCx_CleanMemory</span><span class="p">()</span>
  <span class="n">PLPLx_CleanMemory</span><span class="p">()</span>
  <span class="n">PTPT2_CleanMemory</span><span class="p">()</span>

  <span class="n">ALpxx_CleanMemory</span><span class="p">()</span>
  <span class="n">ASpxx_CleanMemory</span><span class="p">()</span>
  <span class="n">CLxxx_CleanMemory</span><span class="p">()</span>
  <span class="n">CSxxx_CleanMemory</span><span class="p">()</span>
  <span class="n">DISKL_CleanMemory</span><span class="p">()</span>
  <span class="n">PT2DL_CleanMemory</span><span class="p">()</span>

  <span class="n">mecaMAILx_CleanMemory</span><span class="p">()</span>
  <span class="n">therMAILx_CleanMemory</span><span class="p">()</span>
  <span class="n">poroMAILx_CleanMemory</span><span class="p">()</span>
  <span class="n">multiMAILx_CleanMemory</span><span class="p">()</span>
  <span class="n">MAILx_CleanMemory</span><span class="p">()</span>

  <span class="n">CYLND_CleanMemory</span><span class="p">()</span>
  <span class="n">DNLYC_CleanMemory</span><span class="p">()</span>
  <span class="n">PLANx_CleanMemory</span><span class="p">()</span>
  <span class="n">POLYR_CleanMemory</span><span class="p">()</span>
  <span class="n">PT3Dx_CleanMemory</span><span class="p">()</span>
  <span class="n">SPHER_CleanMemory</span><span class="p">()</span>

  <span class="n">RBDY3_CleanMemory</span><span class="p">()</span>
  <span class="n">MBS3D_finalize</span><span class="p">()</span>

  <span class="n">DISKx_CleanMemory</span><span class="p">()</span>
  <span class="n">JONCx_CleanMemory</span><span class="p">()</span>
  <span class="n">POLYG_CleanMemory</span><span class="p">()</span>
  <span class="n">PT2Dx_CleanMemory</span><span class="p">()</span>
  <span class="n">xKSID_CleanMemory</span><span class="p">()</span>

  <span class="n">RBDY2_CleanMemory</span><span class="p">()</span>
  <span class="n">MBS2D_finalize</span><span class="p">()</span>

  <span class="n">postpro_CleanMemory</span><span class="p">()</span>
  <span class="n">postpro_3D_CleanMemory</span><span class="p">()</span>

  <span class="n">nlgs_IsInitialized</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">nlgs_3D_IsInitialized</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">io_hdf5_cleanMemory</span><span class="p">()</span>
  <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="k">pass</span>

  <span class="n">timer_WriteOutTimers</span><span class="p">()</span>

  <span class="n">overall_Finalize</span><span class="p">()</span>
  <span class="n">utilities_Finalize</span><span class="p">()</span>

  <span class="n">wdf</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="n">dict_fid</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">dict_fgp</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">fvtk</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">inters_list</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">vblock_list</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">get_mdl</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">get_tac</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">get_sta</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">get_int</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">int_id</span>  <span class="o">=</span> <span class="kc">None</span>

  <span class="n">inter_mapper</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">registers2display</span> <span class="o">=</span> <span class="kc">False</span>

  <span class="n">DIMENSION</span> <span class="o">=</span> <span class="kc">None</span></div>


<span class="c1">### --- ###</span>
<div class="viewcode-block" id="AssembleMechanicalLHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleMechanicalLHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleMechanicalLHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary matrices of mechanical deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">mecaMAILx_AssembKT</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssembleMechanicalRHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleMechanicalRHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleMechanicalRHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary right hand sides of mechanical deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">mecaMAILx_AssembRHS</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssembleThermalLHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleThermalLHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleThermalLHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary matrices of thermal deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">PT2DL_AssembThermKT</span><span class="p">()</span>
  <span class="n">therMAILx_AssembThermKT</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssembleThermalRHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleThermalRHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleThermalRHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary right hand sides of thermal deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">PT2DL_AssembThermRHS</span><span class="p">()</span>
  <span class="n">therMAILx_AssembThermRHS</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssemblePoroLHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssemblePoroLHS">[docs]</a><span class="k">def</span> <span class="nf">AssemblePoroLHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary matrices of porous deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">poroMAILx_AssembKT</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssemblePoroRHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssemblePoroRHS">[docs]</a><span class="k">def</span> <span class="nf">AssemblePoroRHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary right hand sides of porous deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">poroMAILx_AssembRHS</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssembleMultiLHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleMultiLHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleMultiLHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary matrices of multi-phasic deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">multiMAILx_AssembKT</span><span class="p">()</span></div>

<div class="viewcode-block" id="AssembleMultiRHS"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AssembleMultiRHS">[docs]</a><span class="k">def</span> <span class="nf">AssembleMultiRHS</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Assemble the elementary right hand sides of multi-phasic deformable bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">multiMAILx_AssembRHS</span><span class="p">()</span></div>

<div class="viewcode-block" id="CircularSelection"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.CircularSelection">[docs]</a><span class="k">def</span> <span class="nf">CircularSelection</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Select a subpart of a 2D sample to apply it post processing commands.</span>

<span class="sd">  The subpart of the sample consists of all particles in a disk around a point.</span>

<span class="sd">  parameters:</span>

<span class="sd">  - x: abscissa of the center of the disk</span>
<span class="sd">  - y: ordinate of the center of the disk</span>
<span class="sd">  - r: radius of the disk centered on (x;y).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">postpro_SetCircularSelectionZone</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
   <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;ERROR: CircularSelection works only with dimension 2&#39;</span><span class="p">)</span>
   <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="ComputeBulk"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeBulk">[docs]</a><span class="k">def</span> <span class="nf">ComputeBulk</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Compute rigidity/conductivity elementary matrices and internal forces</span>
<span class="sd">  for all bodies in the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ComputeBulk</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ComputeBulk</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeBulk] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>

  <span class="n">mecaMAILx_ComputeBulk</span><span class="p">()</span>
  <span class="n">therMAILx_ComputeInternalFlux</span><span class="p">()</span>
  <span class="n">poroMAILx_ComputeBulk</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeBulk</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComputeDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeDof">[docs]</a><span class="k">def</span> <span class="nf">ComputeDof</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Compute current values of displacement from the current velocities computed</span>
<span class="sd">  for all bodies in the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ComputeDof</span><span class="p">()</span>
    <span class="n">MBS2D_ComputeDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ComputeDof</span><span class="p">()</span>
    <span class="n">MBS3D_ComputeDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ComputeDof</span><span class="p">()</span>
  <span class="n">mecaMAILx_ComputeField</span><span class="p">()</span>
  <span class="n">poroMAILx_ComputeDof</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeDof</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeField</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComputeFext"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeFext">[docs]</a><span class="k">def</span> <span class="nf">ComputeFext</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Evaluate the sum of the external forces during the current time step (due to gravity and boundary conditions)</span>
<span class="sd">  for all bodies in the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ComputeFext</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ComputeFext</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeFext] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ComputeFext</span><span class="p">()</span>
  <span class="n">therMAILx_ComputeExternalFlux</span><span class="p">()</span>
  <span class="n">poroMAILx_ComputeFext</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeFext</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComputeFreeVelocity"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeFreeVelocity">[docs]</a><span class="k">def</span> <span class="nf">ComputeFreeVelocity</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Compute velocity free of interactions for all mechanical bodies in the simulation.</span>

<span class="sd">  The contact detection configuration is also computed then, except if a</span>
<span class="sd">  the command &#39;Integrator_SetContactDetectionConfiguration&#39; is used.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ComputeFreeVelocity</span><span class="p">()</span>
    <span class="n">MBS2D_ComputeFreeVelocity</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ComputeFreeVelocity</span><span class="p">()</span>
    <span class="n">MBS3D_ComputeFreeVelocity</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeFreeVelocity] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ComputeFreeVelocity</span><span class="p">()</span>
  <span class="n">poroMAILx_ComputeFreeVelocity</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeFreeState</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComputeMass"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeMass">[docs]</a><span class="k">def</span> <span class="nf">ComputeMass</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Compute mass/capacity elementary matrices</span>
<span class="sd">  for all bodies in the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ComputeMass</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ComputeMass</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeMass] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ComputeMass</span><span class="p">()</span>
  <span class="n">poroMAILx_ComputeMass</span><span class="p">()</span>
  <span class="n">multiMAILx_ComputeMass</span><span class="p">()</span></div>

<div class="viewcode-block" id="ComputeRnod"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ComputeRnod">[docs]</a><span class="k">def</span> <span class="nf">ComputeRnod</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Recompute the &#39;reac&#39; value of each bodies</span>
<span class="sd">  from the contact network (this storage)</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">inter_handler_2D_computeRnod</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">inter_handler_3D_computeRnod</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ComputeRnod] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="SetContactRadius"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SetContactRadius">[docs]</a><span class="k">def</span> <span class="nf">SetContactRadius</span><span class="p">(</span><span class="n">radius</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set the contact radius for spher/spher or cylinder/cylinder contacts.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">SPSPx_SetContactRadius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>
    <span class="n">CDCDx_SetContactRadius</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span></div>

<div class="viewcode-block" id="DisplayOutDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.DisplayOutDof">[docs]</a><span class="k">def</span> <span class="nf">DisplayOutDof</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Display the current values of all degrees of freedom in the simulation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_DisplayOutDof</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_DisplayOutDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_DisplayOutDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:DisplayOutDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_DisplayOutDof</span><span class="p">()</span>
  <span class="n">therMAILx_DisplayOutDof</span><span class="p">()</span>
  <span class="n">poroMAILx_DisplayOutDof</span><span class="p">()</span></div>

<div class="viewcode-block" id="DisplayOutRnod"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.DisplayOutRnod">[docs]</a><span class="k">def</span> <span class="nf">DisplayOutRnod</span><span class="p">(</span><span class="n">ifrom</span><span class="p">,</span> <span class="n">ito</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Display the current values of reactions on all bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_DisplayOutRnod</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_DisplayOutRnod</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_DisplayOutRnod</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:DisplayOutRnod] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_DisplayOutRnod</span><span class="p">()</span>
  <span class="n">therMAILx_DisplayOutRnod</span><span class="p">()</span>
  <span class="n">poroMAILx_DisplayOutRnod</span><span class="p">()</span></div>

<div class="viewcode-block" id="DisplayOutVlocRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.DisplayOutVlocRloc">[docs]</a><span class="k">def</span> <span class="nf">DisplayOutVlocRloc</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Display the current values of every contacts.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_DisplayOutVlocRloc</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">CLJCx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKALp_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKL_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKJCx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKKDx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKPLx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">P2P2L_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLALp_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLJCx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLPLx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT2_DisplayOutVlocRloc</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">CDPLx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">CSASp_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRASp_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">CSPRx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRPLx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRPRx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT3_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPCDx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPDCx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPPLx_DisplayOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPPRx_DisplayOutVlocRloc</span><span class="p">()</span>    
    <span class="n">SPSPx_DisplayOutVlocRloc</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:DisplayOutVlocRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="DisplayProxTactors"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.DisplayProxTactors">[docs]</a><span class="k">def</span> <span class="nf">DisplayProxTactors</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Display the list of contacts.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">overall_DisplayProxTactors</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">CLJCx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKALp_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKDKL_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKDKx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKJCx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKKDx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">DKPLx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">P2P2L_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PLALp_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PLJCx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PLPLx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PTPT2_DisplayProxTactors</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">CDPLx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">CSASp_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PRASp_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">CSPRx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PRPLx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PRPRx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">PTPT3_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">SPCDx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">SPDCx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">SPPLx_DisplayProxTactors</span><span class="p">()</span>
    <span class="n">SPPRx_DisplayProxTactors</span><span class="p">()</span>    
    <span class="n">SPSPx_DisplayProxTactors</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:DisplayProxTactors] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="FdSelectProxTactors"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.FdSelectProxTactors">[docs]</a><span class="k">def</span> <span class="nf">FdSelectProxTactors</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Special way of computing sphere/sphere contacts.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">SPSPx_FdSelectProxTactors</span><span class="p">()</span></div>

<div class="viewcode-block" id="FatalDamping"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.FatalDamping">[docs]</a><span class="k">def</span> <span class="nf">FatalDamping</span><span class="p">(</span><span class="n">bodies</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Compute fatal damping for all bodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>

  <span class="k">if</span> <span class="n">bodies</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR : Cannot use input list of bodies in macro function.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        Please use specific function prefixed with either RBDY2_, RBDY3_ or mecaMAILx_ .&#39;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_FatalDamping</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_FatalDamping</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:FatalDamping] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_FatalDamping</span><span class="p">()</span></div>

<div class="viewcode-block" id="IncrementStep"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.IncrementStep">[docs]</a><span class="k">def</span> <span class="nf">IncrementStep</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Prepare a new time step computation.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">overall_CleanWriteOutFlags</span><span class="p">()</span>
  <span class="n">TimeEvolution_IncrementStep</span><span class="p">()</span>
  <span class="n">TimeEvolution_DisplayStep</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_IncrementStep</span><span class="p">()</span>
    <span class="n">MBS2D_IncrementStep</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_IncrementStep</span><span class="p">()</span>
    <span class="n">MBS3D_IncrementStep</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:IncrementStep] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_IncrementStep</span><span class="p">()</span>
  <span class="n">therMAILx_IncrementStep</span><span class="p">()</span>
  <span class="n">poroMAILx_IncrementStep</span><span class="p">()</span>
  <span class="n">multiMAILx_IncrementStep</span><span class="p">()</span></div>

<div class="viewcode-block" id="LoadBehaviours"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.LoadBehaviours">[docs]</a><span class="k">def</span> <span class="nf">LoadBehaviours</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Load behaviours read in BULK_BEHAV.DAT in </span>
<span class="sd">  bodies read from BODIES.DAT.</span>

<span class="sd">  Must be called after: ReadBehaviours and ReadBodies.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">mecaMAILx_LoadBehaviours</span><span class="p">()</span>
  <span class="n">therMAILx_LoadBehaviours</span><span class="p">()</span>
  <span class="n">poroMAILx_LoadBehaviours</span><span class="p">()</span>
  <span class="n">multiMAILx_LoadBehaviours</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_LoadBehaviours</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_LoadBehaviours</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:LoadBehaviours] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="LoadModels"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.LoadModels">[docs]</a><span class="k">def</span> <span class="nf">LoadModels</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Load models read in MODELS.DAT in </span>
<span class="sd">  bodies read from BODIES.DAT and initialize property sets.</span>

<span class="sd">  Must be called after : ReadModels and ReadBodies.</span>
<span class="sd">  Must be called before: LoadTactors</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">models_InitProperties</span><span class="p">()</span>
  <span class="n">mecaMAILx_LoadModels</span><span class="p">()</span>
  <span class="n">mecaMAILx_PushProperties</span><span class="p">()</span>
  <span class="n">therMAILx_LoadModels</span><span class="p">()</span>
  <span class="n">therMAILx_PushProperties</span><span class="p">()</span>
  <span class="n">poroMAILx_LoadModels</span><span class="p">()</span>
  <span class="n">poroMAILx_PushProperties</span><span class="p">()</span>
  <span class="n">multiMAILx_LoadModels</span><span class="p">()</span>
  <span class="n">multiMAILx_PushProperties</span><span class="p">()</span>
  <span class="n">models_StoreProperties</span><span class="p">()</span>
  <span class="c1">#ExternalModels_CheckProperties()</span>
  <span class="n">ExternalModels_StoreProperties</span><span class="p">()</span>
  <span class="n">mecaMAILx_CheckProperties</span><span class="p">()</span>
  <span class="n">therMAILx_CheckProperties</span><span class="p">()</span>
  <span class="n">poroMAILx_CheckProperties</span><span class="p">()</span></div>
  <span class="c1">#multiMAILx_CheckProperties()</span>

<div class="viewcode-block" id="LoadTactors"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.LoadTactors">[docs]</a><span class="k">def</span> <span class="nf">LoadTactors</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Load contactor modules from bodies.</span>

<span class="sd">  Must be called after: ReadBodies, ReadIniDof and LoadModels if any mesh.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">DISKx_LoadTactors</span><span class="p">()</span>
    <span class="n">JONCx_LoadTactors</span><span class="p">()</span>
    <span class="n">POLYG_LoadTactors</span><span class="p">()</span>
    <span class="n">PT2Dx_LoadTactors</span><span class="p">()</span>
    <span class="n">xKSID_LoadTactors</span><span class="p">()</span>

    <span class="n">ALpxx_LoadTactors</span><span class="p">()</span>
    <span class="n">CLxxx_LoadTactors</span><span class="p">()</span>
    <span class="n">DISKL_LoadTactors</span><span class="p">()</span>
    <span class="n">PT2DL_LoadTactors</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">ASpxx_LoadTactors</span><span class="p">()</span>
    <span class="n">CSxxx_LoadTactors</span><span class="p">()</span>

    <span class="n">CYLND_LoadTactors</span><span class="p">()</span>
    <span class="n">DNLYC_LoadTactors</span><span class="p">()</span>
    <span class="n">PLANx_LoadTactors</span><span class="p">()</span>
    <span class="n">POLYR_LoadTactors</span><span class="p">()</span>
    <span class="n">PT3Dx_LoadTactors</span><span class="p">()</span>
    <span class="n">SPHER_LoadTactors</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:LoadTactors] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>

  <span class="n">overall_InitEntityList</span><span class="p">()</span></div>

<div class="viewcode-block" id="AddDof2InBodies"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.AddDof2InBodies">[docs]</a><span class="k">def</span> <span class="nf">AddDof2InBodies</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Change reference coordinates to current coordinates.</span>
<span class="sd">  Usefull to generate a BODIES.OUT corresponding to current state.</span>

<span class="sd">  Not available for 3D rigids!</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_addDof2InBodies</span><span class="p">()</span>
  <span class="n">mecaMAILx_addDof2InBodies</span><span class="p">()</span></div>

<div class="viewcode-block" id="SetNumberInteractionByContact"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SetNumberInteractionByContact">[docs]</a><span class="k">def</span> <span class="nf">SetNumberInteractionByContact</span><span class="p">(</span><span class="n">nb</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Experimental: set the number of interaction by contact.</span>

<span class="sd">  Available only for sphere/sphere and cylinder/cylinder contacts.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">SPSPx_SetNumberInterByContact</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
    <span class="n">CDCDx_SetNumberInterByContact</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span></div>

<div class="viewcode-block" id="SetPeriodicCondition"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SetPeriodicCondition">[docs]</a><span class="k">def</span> <span class="nf">SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yperiod</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set periodic conditions for rigid bodies.</span>

<span class="sd">  Only: </span>

<span class="sd">  - 2D: x period for DKDKx, DKDKL and PLPLx.</span>
<span class="sd">  - 3D: x and y period for CDCDx, SPSPx, PRPRx and PTPT3</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">xperiod</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">RBDY2_SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">DKDKx_SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">DKDKL_SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">PLPLx_SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">DKPLx_SetPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>      
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">xperiod</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">RBDY3_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">CDCDx_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">SPSPx_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">SPPRx_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>      
      <span class="n">PRPRx_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
      <span class="n">PTPT3_SetXPeriodicCondition</span><span class="p">(</span><span class="n">xperiod</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yperiod</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">RBDY3_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>
      <span class="n">CDCDx_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>
      <span class="n">SPSPx_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>
      <span class="n">SPPRx_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>      
      <span class="n">PRPRx_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>
      <span class="n">PTPT3_SetYPeriodicCondition</span><span class="p">(</span><span class="n">yperiod</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:SetPeriodicCondition] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="SetDomainBoundary"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SetDomainBoundary">[docs]</a><span class="k">def</span> <span class="nf">SetDomainBoundary</span><span class="p">(</span><span class="n">Xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Set active domain boundary for rigid bodies.</span>

<span class="sd">  Only: </span>

<span class="sd">  - 2D: x | y boundary</span>
<span class="sd">  - 3D: x | y | z boundary </span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Xmin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY2_SetXminBoundary</span><span class="p">(</span><span class="n">Xmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Xmax</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY2_SetXmaxBoundary</span><span class="p">(</span><span class="n">Xmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ymin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY2_SetYminBoundary</span><span class="p">(</span><span class="n">Ymin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ymax</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY2_SetYmaxBoundary</span><span class="p">(</span><span class="n">Ymax</span><span class="p">)</span>      
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Xmin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetXminBoundary</span><span class="p">(</span><span class="n">Xmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Xmax</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetXmaxBoundary</span><span class="p">(</span><span class="n">Xmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ymin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetYminBoundary</span><span class="p">(</span><span class="n">Ymin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ymax</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetYmaxBoundary</span><span class="p">(</span><span class="n">Ymax</span><span class="p">)</span>      
    <span class="k">if</span> <span class="n">Zmin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetZminBoundary</span><span class="p">(</span><span class="n">Zmin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Zmax</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="n">RBDY3_SetZmaxBoundary</span><span class="p">(</span><span class="n">Zmax</span><span class="p">)</span>      
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:SetDomainBoundary] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="ReadBehaviours"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadBehaviours">[docs]</a><span class="k">def</span> <span class="nf">ReadBehaviours</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Read TACT_BEHAV.DAT and BULK_BEHAV.DAT files in DATBOX directory.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">get_law</span>

  <span class="n">bulk_behav_ReadBehaviours</span><span class="p">()</span>
  <span class="n">tact_behav_ReadBehaviours</span><span class="p">()</span>

  <span class="n">law_id</span>  <span class="o">=</span> <span class="p">{</span> <span class="n">ilaw</span><span class="p">:</span><span class="n">tact_behav_GetTactBehav</span><span class="p">(</span><span class="n">ilaw</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">ilaw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)}</span>
  <span class="n">get_law</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">law_id</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S5&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="ReadModels"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadModels">[docs]</a><span class="k">def</span> <span class="nf">ReadModels</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Read MODELS.DAT file in DATBOX directory and initialize external models.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">models_ReadModels</span><span class="p">()</span>

  <span class="n">models_InitModels</span><span class="p">()</span>
  <span class="n">ExternalModels_InitModels</span><span class="p">()</span></div>

<div class="viewcode-block" id="ReadBodies"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadBodies">[docs]</a><span class="k">def</span> <span class="nf">ReadBodies</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Read BODIES.DAT file in DATBOX directory.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>

  <span class="k">if</span> <span class="n">version</span> <span class="p">:</span>
    <span class="n">MAILx_ReadBodies</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="n">MAILx_ReadBodies</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ReadBodies</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ReadBodies</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadBodies] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="ReadDrivenDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadDrivenDof">[docs]</a><span class="k">def</span> <span class="nf">ReadDrivenDof</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Read DRV_DOF.DAT file in DATBOX directory.</span>

<span class="sd">  Must be called after ReadIniDof.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ReadDrivenDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ReadDrivenDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadDrivenDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ReadDrivenDof</span><span class="p">()</span>
  <span class="n">therMAILx_ReadDrivenDof</span><span class="p">()</span>
  <span class="n">poroMAILx_ReadDrivenDof</span><span class="p">()</span>
  <span class="n">multiMAILx_ReadDrivenDof</span><span class="p">()</span></div>

<div class="viewcode-block" id="ReadIniDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadIniDof">[docs]</a><span class="k">def</span> <span class="nf">ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read DOF file.</span>
<span class="sd">  If record = 0 read DATBOX/DOF.INI file,</span>
<span class="sd">  if record &gt; 0 read OUTBOX/DOF.OUT.record file,</span>
<span class="sd">  if record &lt; 0 read OUTBOX/DOF.LAST file,</span>
<span class="sd">  and next written will be OUTBOX/DOF.OUT.record.</span>
<span class="sd">  Must be called after LoadBehaviours.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadIniDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">therMAILx_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">poroMAILx_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">multiMAILx_ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReadIniGPV"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadIniGPV">[docs]</a><span class="k">def</span> <span class="nf">ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read GPV file.</span>
<span class="sd">  If record = 0 read DATBOX/GPV.INI file,</span>
<span class="sd">  if record &gt; 0 read OUTBOX/GPV.OUT.record file,</span>
<span class="sd">  if record &lt; 0 read OUTBOX/GPV.LAST file,</span>
<span class="sd">  and next written will be OUTBOX/GPV.OUT.record.</span>
<span class="sd">  Must be called after LoadModels.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">TimeEvolution_ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">mecaMAILx_ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">therMAILx_ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">poroMAILx_ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="n">multiMAILx_ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReadIniVlocRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadIniVlocRloc">[docs]</a><span class="k">def</span> <span class="nf">ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Read VlocRloc file.</span>
<span class="sd">  If record = 0 read DATBOX/VlocRloc.INI file,</span>
<span class="sd">  if record &gt; 0 read OUTBOX/VlocRloc.OUT.record file,</span>
<span class="sd">  if record &lt; 0 read OUTBOX/VlocRloc.LAST file,</span>
<span class="sd">  and next written will be OUTBOX/VlocRloc.OUT.record.</span>
<span class="sd">  Must be called after LoadTactors.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">CLJCx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKALp_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKDKL_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKDKx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKJCx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKKDx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">DKPLx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">P2P2L_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PLALp_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PLJCx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PLPLx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PTPT2_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">CDPLx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">CSASp_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PRASp_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">CSPRx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PRPLx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PRPRx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">PTPT3_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">SPCDx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">SPDCx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">SPPLx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="n">SPPRx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>    
    <span class="n">SPSPx_ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadIniVlocRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="ReadIniMpValues"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadIniMpValues">[docs]</a><span class="k">def</span> <span class="nf">ReadIniMpValues</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Read MP_VALUES file.</span>
<span class="sd">  If record = 0 read DATBOX/MP_VALUES.INI file,</span>
<span class="sd">  if record &gt; 0 read OUTBOX/MP_VALUES.OUT.record file,</span>
<span class="sd">  if record &lt; 0 read OUTBOX/MP_VALUES.LAST file,</span>
<span class="sd">  and next written will be OUTBOX/MP_VALUES.OUT.record.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_ReadIniMpValues</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_ReadIniMpValues</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_ReadIniMpValues</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadIniMpValues] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="ReadMpBehaviours"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadMpBehaviours">[docs]</a><span class="k">def</span> <span class="nf">ReadMpBehaviours</span><span class="p">(</span><span class="n">disper</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;therm&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Read and load multi-physics (for rigids) behaviours.</span>

<span class="sd">  What is disper ?</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_ReadMpBehaviour</span><span class="p">()</span>
    <span class="n">RBDY2_MP_LoadBehaviours</span><span class="p">(</span><span class="n">disper</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_ReadMpBehaviour</span><span class="p">()</span>
    <span class="n">RBDY3_MP_LoadBehaviours</span><span class="p">(</span><span class="n">disper</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadMpBehaviours] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="ReadPostproFile"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadPostproFile">[docs]</a><span class="k">def</span> <span class="nf">ReadPostproFile</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read DATBOX/POSTPRO.DAT file</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">postpro_ReadCommands</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">postpro_3D_ReadCommands</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ReadPostproFile] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="ReadIni"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadIni">[docs]</a><span class="k">def</span> <span class="nf">ReadIni</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">h5_file</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Read initial state</span>

<span class="sd">  If compiled with HDF5 library, it can read from</span>
<span class="sd">  the &#39;h5_file&#39; input parameters.</span>

<span class="sd">  Otherwise the function will try to read from OUTBOX directory</span>

<span class="sd">  With HDF5, if &#39;record&#39; is &lt; 1, then last record is read.</span>
<span class="sd">  With OUTBOX, if &#39;record&#39; is -1, then .LAST are read.</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">if</span> <span class="n">h5_file</span><span class="p">:</span>

    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">overall_GetWorkingDirectory</span><span class="p">())</span>
    <span class="n">h5_path</span> <span class="o">=</span> <span class="n">h5_path</span><span class="o">/</span><span class="n">h5_file</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">h5_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR input h5_file does not exist :&#39;</span><span class="p">,</span><span class="n">h5_file</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">io_hdf5_read</span><span class="p">(</span><span class="n">h5_file</span><span class="p">,</span><span class="n">record</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;INFO: You are not able to initialize output file in HDF5 format.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
             <span class="s2">&quot;      To be able to write in HDF5 format, please enable the </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
             <span class="s2">&quot;      WITH_HDF5 flag at the compilation time.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
             <span class="s2">&quot;      Example: cmake -DWITH_HDF5=ON .. &amp;&amp; make -j8&quot;</span> <span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>

    <span class="n">ReadIniDof</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="c1"># should check against see_table...</span>
    <span class="k">if</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ReadIniVlocRloc</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">MAILx_GetNbMAILx</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ReadIniGPV</span><span class="p">(</span><span class="n">record</span><span class="p">)</span></div>

<div class="viewcode-block" id="RecupRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.RecupRloc">[docs]</a><span class="k">def</span> <span class="nf">RecupRloc</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Try to get back state of interactions from last stocked interactions.</span>

<span class="sd">  In each contact module: verlet -&gt; this. Must be called before SelectProxTactors.</span>

<span class="sd">  If tol is given in input, PLPLx_RecupRlocByPosition is used. To use the</span>
<span class="sd">  same type of function for PRPRx contact, use PRPRx_SetTolRecupRloc.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">inter_id</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">CLJCx_ID</span><span class="p">,</span> <span class="n">DKALp_ID</span><span class="p">,</span> <span class="n">DKDKL_ID</span><span class="p">,</span> <span class="n">DKDKx_ID</span><span class="p">,</span> <span class="n">DKJCx_ID</span><span class="p">,</span>
                      <span class="n">DKKDx_ID</span><span class="p">,</span> <span class="n">DKPLx_ID</span><span class="p">,</span> <span class="n">P2P2L_ID</span><span class="p">,</span> <span class="n">PLALp_ID</span><span class="p">,</span> <span class="n">PLJCx_ID</span><span class="p">,</span>
                      <span class="n">PTPT2_ID</span><span class="p">,</span>
                    <span class="p">]:</span>

      <span class="n">inter_handler_2D_recupRloc</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">inter_handler_2D_recupRlocByPos</span><span class="p">(</span><span class="n">CLALp_ID</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
      <span class="n">inter_handler_2D_recupRlocByPos</span><span class="p">(</span><span class="n">PLPLx_ID</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">inter_handler_2D_recupRloc</span><span class="p">(</span><span class="n">CLALp_ID</span><span class="p">)</span>
      <span class="n">inter_handler_2D_recupRloc</span><span class="p">(</span><span class="n">PLPLx_ID</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">tol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">inter_handler_3D_recupRlocByPos</span><span class="p">(</span><span class="n">CSASp_ID</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
      <span class="n">inter_handler_3D_recupRlocByPos</span><span class="p">(</span><span class="n">CSPRx_ID</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">inter_handler_3D_recupRloc</span><span class="p">(</span><span class="n">CSASp_ID</span><span class="p">)</span>
      <span class="n">inter_handler_3D_recupRloc</span><span class="p">(</span><span class="n">CSPRx_ID</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">inter_id</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">CDCDx_ID</span><span class="p">,</span> <span class="n">CDPLx_ID</span><span class="p">,</span> <span class="n">PRASp_ID</span><span class="p">,</span>
                      <span class="n">PRPLx_ID</span><span class="p">,</span> <span class="n">PRPRx_ID</span><span class="p">,</span> <span class="n">PTPT3_ID</span><span class="p">,</span> <span class="n">SPCDx_ID</span><span class="p">,</span>
                      <span class="n">SPDCx_ID</span><span class="p">,</span> <span class="n">SPPLx_ID</span><span class="p">,</span> <span class="n">SPSPx_ID</span><span class="p">,</span> <span class="n">SPPRx_ID</span><span class="p">,</span>
                    <span class="p">]:</span>
      <span class="n">inter_handler_3D_recupRloc</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>

  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:RecupRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="SelectProxTactors"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SelectProxTactors">[docs]</a><span class="k">def</span> <span class="nf">SelectProxTactors</span><span class="p">(</span><span class="n">freq_detec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">useExt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Run detections if current time step number is a multiple of freq_detec.</span>

<span class="sd">  In case of PRPRx contact, one of next functions must be called:</span>

<span class="sd">  - PRPRx_UseCpCundallDetection</span>
<span class="sd">  - PRPRx_UseCpF2fExplicitDetection</span>
<span class="sd">  - PRPRx_UseCpF2fDetection</span>
<span class="sd">  - PRPRx_UseNcDetection</span>
<span class="sd">  - PRPRx_UseNcF2fDetection</span>
<span class="sd">  - PRPRx_UseNcF2fExplicitDetection</span>


<span class="sd">  Parameters:</span>

<span class="sd">  - freq_detec (default 1) : frequency of particules neighbourhood recomputation during detection</span>
<span class="sd">  - useExt (default 0) : set to 1 to use external detections of CLALp interactions (coupling with Xper)</span>
<span class="sd">  - reset (default 0) : set to 1 to reset the detection and redo box computation</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">overall_SelectProxTactors</span><span class="p">(</span><span class="n">freq_detec</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">useExt</span><span class="p">)</span>
    <span class="n">CLJCx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKALp_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKDKL_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKDKx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKJCx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKKDx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">DKPLx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">P2P2L_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PLALp_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PLJCx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PLPLx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PTPT2_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

    <span class="n">CDCDx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">CDPLx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">CSASp_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">useExt</span><span class="p">)</span>
    <span class="n">PRASp_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">CSPRx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PRPLx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PRPRx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">PTPT3_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">SPCDx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">SPDCx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">SPPLx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">SPPRx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>    
    <span class="n">SPSPx_SelectProxTactors</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>

  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:SelectProxTactors] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="SmoothForceComputation"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.SmoothForceComputation">[docs]</a><span class="k">def</span> <span class="nf">SmoothForceComputation</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Explicit computation of the contact forces.</span>

<span class="sd">  Not available for every contact types.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">DKDKL_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">DKDKx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">DKKDx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">DKJCx_SmoothForceComputation</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">CDPLx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">PTPT3_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">SPCDx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">SPDCx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">SPPLx_SmoothForceComputation</span><span class="p">()</span>
    <span class="n">SPPRx_SmoothForceComputation</span><span class="p">()</span>    
    <span class="n">SPSPx_SmoothForceComputation</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:SmoothForceComputation] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="StockRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.StockRloc">[docs]</a><span class="k">def</span> <span class="nf">StockRloc</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Stock state of interactions.</span>

<span class="sd">  In each contact module: this -&gt; verlet. Must be called after SelectProxTactors.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">inter_id</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">CLALp_ID</span><span class="p">,</span> <span class="n">CLJCx_ID</span><span class="p">,</span> <span class="n">DKALp_ID</span><span class="p">,</span> <span class="n">DKDKL_ID</span><span class="p">,</span>
                      <span class="n">DKDKx_ID</span><span class="p">,</span> <span class="n">DKJCx_ID</span><span class="p">,</span> <span class="n">DKKDx_ID</span><span class="p">,</span> <span class="n">DKPLx_ID</span><span class="p">,</span>
                      <span class="n">P2P2L_ID</span><span class="p">,</span> <span class="n">PLALp_ID</span><span class="p">,</span> <span class="n">PLJCx_ID</span><span class="p">,</span> <span class="n">PLPLx_ID</span><span class="p">,</span>
                      <span class="n">PTPT2_ID</span><span class="p">,</span>
                    <span class="p">]:</span>
      <span class="n">inter_handler_2D_stockRloc</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">inter_id</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">CDCDx_ID</span><span class="p">,</span> <span class="n">CDPLx_ID</span><span class="p">,</span> <span class="n">CSASp_ID</span><span class="p">,</span> <span class="n">PRASp_ID</span><span class="p">,</span>
                      <span class="n">CSPRx_ID</span><span class="p">,</span> <span class="n">PRPLx_ID</span><span class="p">,</span> <span class="n">PRPRx_ID</span><span class="p">,</span> <span class="n">PTPT3_ID</span><span class="p">,</span>
                      <span class="n">SPCDx_ID</span><span class="p">,</span> <span class="n">SPDCx_ID</span><span class="p">,</span> <span class="n">SPPLx_ID</span><span class="p">,</span> <span class="n">SPPRx_ID</span><span class="p">,</span> <span class="n">SPSPx_ID</span><span class="p">,</span>
                    <span class="p">]:</span>
      <span class="n">inter_handler_3D_stockRloc</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:StockRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="UpdateStep"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.UpdateStep">[docs]</a><span class="k">def</span> <span class="nf">UpdateStep</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Update state.</span>

<span class="sd">  Current time step values become begin time step values.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_UpdateStep</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_UpdateDof</span><span class="p">()</span>
    <span class="n">MBS2D_UpdateDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_UpdateDof</span><span class="p">()</span>
    <span class="n">MBS3D_UpdateDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:UpdateStep] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_UpdateDof</span><span class="p">()</span>
  <span class="n">mecaMAILx_UpdateBulk</span><span class="p">()</span>
  <span class="n">therMAILx_UpdateThermDof</span><span class="p">()</span>
  <span class="n">therMAILx_UpdateThermBulk</span><span class="p">()</span>
  <span class="n">poroMAILx_UpdateDof</span><span class="p">()</span>
  <span class="n">poroMAILx_UpdateBulk</span><span class="p">()</span>
  <span class="n">multiMAILx_UpdateDof</span><span class="p">()</span>
  <span class="n">multiMAILx_UpdateBulk</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteBehaviours"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteBehaviours">[docs]</a><span class="k">def</span> <span class="nf">WriteBehaviours</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write materials and contact laws in ascii files (OUTBOX/BULK_BEHAV.OUT and OUTBOX/TACT_BEHAV.OUT).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">bulk_behav_WriteBehaviours</span><span class="p">()</span>
  <span class="n">tact_behav_WriteBehaviours</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteBodies"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteBodies">[docs]</a><span class="k">def</span> <span class="nf">WriteBodies</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write bodies in ascii file (OUTBOX/BODIES.OUT).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">overall_WriteBodies</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">version</span> <span class="p">:</span>
    <span class="n">MAILx_WriteBodies</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="n">MAILx_WriteBodies</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteBodies</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteBodies</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteBodies] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="WriteDrivenDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteDrivenDof">[docs]</a><span class="k">def</span> <span class="nf">WriteDrivenDof</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write driven degrees of freedom in ascii file (OUTBOX/DRV_DOF.OUT).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">overall_WriteDrivenDof</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteDrivenDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteDrivenDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteDrivenDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_WriteDrivenDof</span><span class="p">()</span>
  <span class="n">therMAILx_WriteDrivenDof</span><span class="p">()</span>
  <span class="n">poroMAILx_WriteDrivenDof</span><span class="p">()</span>
  <span class="n">multiMAILx_WriteDrivenDof</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteLastDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLastDof">[docs]</a><span class="k">def</span> <span class="nf">WriteLastDof</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write last degreees of freedom values in ascii file (OUTBOX/DOF.LAST).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteLastDof</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteLastDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteLastDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteLastDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_WriteLastDof</span><span class="p">()</span>
  <span class="n">therMAILx_WriteLastDof</span><span class="p">()</span>
  <span class="n">poroMAILx_WriteLastDof</span><span class="p">()</span>
  <span class="n">multiMAILx_WriteLastDof</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteLastGPV"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLastGPV">[docs]</a><span class="k">def</span> <span class="nf">WriteLastGPV</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write last Gauss points values in ascii file (OUTBOX/GPV.LAST).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">TimeEvolution_WriteLastGPV</span><span class="p">()</span>
  <span class="n">MAILx_WriteLastGPV</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteLastRnod"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLastRnod">[docs]</a><span class="k">def</span> <span class="nf">WriteLastRnod</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write last nodal reaction in ascii file (OUTBOX/Rnod.LAST).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteLastRnod</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteLastRnod</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteLastRnod</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteLastRnod] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_WriteLastRnod</span><span class="p">()</span>
  <span class="n">therMAILx_WriteLastRnod</span><span class="p">()</span>
  <span class="n">poroMAILx_WriteLastRnod</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteLastVlocRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLastVlocRloc">[docs]</a><span class="k">def</span> <span class="nf">WriteLastVlocRloc</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write last interactions values in ascii file (OUTBOX/VlocRloc.LAST).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteLastVlocRloc</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">CLJCx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKALp_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKL_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKJCx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKKDx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">DKPLx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">P2P2L_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PLALp_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PLJCx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PLPLx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT2_WriteLastVlocRloc</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">CDPLx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">CSASp_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PRASp_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">CSPRx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PRPLx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PRPRx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT3_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">SPCDx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">SPDCx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">SPPLx_WriteLastVlocRloc</span><span class="p">()</span>
    <span class="n">SPPRx_WriteLastVlocRloc</span><span class="p">()</span>    
    <span class="n">SPSPx_WriteLastVlocRloc</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteLastVlocRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="WriteLastMpValues"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLastMpValues">[docs]</a><span class="k">def</span> <span class="nf">WriteLastMpValues</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write last mp values in ascii file (OUTBOX/MP_VALUES.LAST).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteLastMpValues</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_WriteLastMpValues</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_WriteLastMpValues</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteLastMpValues] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="WriteOutDof"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOutDof">[docs]</a><span class="k">def</span> <span class="nf">WriteOutDof</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write degrees of freedom of current time step in ascii file (OUTBOX/DOF.x.OUT where &#39;x&#39; is the rank of the file)</span>
<span class="sd">  if current time step number is multiple of nsteps.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>

  <span class="c1"># If it is not a step to write Vloc_Rloc, continue</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">TimeEvolution_GetStep</span><span class="p">()</span> <span class="o">%</span> <span class="n">nsteps</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span>

  <span class="n">TimeEvolution_WriteOutDof</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteOutDof</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteOutDof</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteOutDof] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>

  <span class="n">mecaMAILx_WriteOutDof</span><span class="p">()</span>
  <span class="n">therMAILx_WriteOutDof</span><span class="p">()</span>
  <span class="n">poroMAILx_WriteOutDof</span><span class="p">()</span>
  <span class="n">multiMAILx_WriteOutDof</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">WriteOutMpValues</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write mp values of current time step in ascii file (OUTBOX/MP_VALUES.x.OUT where &#39;x&#39; is the rank of the file)</span>
<span class="sd">  if current time step number is multiple of nsteps.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteOutMpValues</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_WriteOutMpValues</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_WriteOutMpValues</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteOutMpValues] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>


<div class="viewcode-block" id="WriteMpBehaviours"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteMpBehaviours">[docs]</a><span class="k">def</span> <span class="nf">WriteMpBehaviours</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Write Multi-physics ascii file in OUTBOX directory.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_WriteMpBehaviour</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_WriteMpBehaviour</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteMpBehaviours] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="OpenDisplayFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.OpenDisplayFiles">[docs]</a><span class="k">def</span> <span class="nf">OpenDisplayFiles</span><span class="p">(</span><span class="n">restart</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mecagp_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">thergp_field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_f2f</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">write_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Initialize visualization file writing.</span>

<span class="sd">  Parameters:  </span>

<span class="sd">  - restart (int)   : first index of file to write</span>
<span class="sd">  - mecagp_field (list of strings) : the list of meca GP field to display (&#39;strain&#39; and/or &#39;stress&#39;)</span>
<span class="sd">  - thergp_field (list of strings) : the list of ther GP field to display (&#39;gradT&#39; and/or &#39;fluxT&#39;)</span>
<span class="sd">  - write_f2f (integer) : 0 do not write, 1 write only f2f, 2 also write central kernel, 3 add stress</span>
<span class="sd">  - write_parameters (boolean) : True (default) write integer to string parameters mapping in separate file</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">wdf</span><span class="p">,</span> <span class="n">dict_fid</span><span class="p">,</span> <span class="n">dict_fgp</span><span class="p">,</span> <span class="n">inters_list</span><span class="p">,</span> <span class="n">fvtk</span><span class="p">,</span> <span class="n">vblock_list</span>

  <span class="n">wdf</span> <span class="o">=</span> <span class="n">restart</span><span class="o">-</span><span class="mi">1</span>

  <span class="n">tact_names</span>  <span class="o">=</span> <span class="kc">None</span>
  <span class="n">inter_names</span> <span class="o">=</span> <span class="kc">None</span>
  <span class="n">tacts_dict</span>  <span class="o">=</span> <span class="p">{}</span>

  <span class="c1"># the dict_fid contains for each type of file (which is the key):</span>
  <span class="c1"># a tuple with : a file descriptor, a vtkUnstructuredGrid (may be None),</span>
  <span class="c1"># and an emtpy dictionnary for the options</span>
  <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">is_vtk_display</span> <span class="p">:</span>

    <span class="n">wd</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">overall_GetWorkingDirectory</span><span class="p">())</span>

    <span class="n">nbm</span> <span class="o">=</span> <span class="n">mecaMAILx_GetNbMecaMAILx</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">write_parameters</span><span class="p">:</span>
      <span class="n">writeParametersToCsv</span><span class="p">(</span><span class="n">wd</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nbm</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
      <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mecafe&#39;</span><span class="p">)</span>
      <span class="n">mecafe_grid</span> <span class="o">=</span> <span class="n">InitMecaFeToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
      <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;mecafe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mecafe_grid</span><span class="p">,</span> <span class="p">{})</span>

      <span class="n">writexSxxxToVTK</span><span class="p">(</span><span class="n">wd</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">mecagp_field</span><span class="p">:</span>
        <span class="n">accept</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stress&#39;</span><span class="p">,</span> <span class="s1">&#39;strain&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mecagp_field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">mecagp_field</span> <span class="o">=</span> <span class="p">[</span><span class="n">mecagp_field</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mf</span> <span class="ow">in</span> <span class="n">mecagp_field</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown mecagp_field argument, must be &#39;stress&#39; or &#39;strain&#39; (not &#39;</span><span class="si">{</span><span class="n">mf</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
          <span class="k">assert</span> <span class="n">mf</span> <span class="ow">in</span> <span class="n">accept</span><span class="p">,</span> <span class="n">msg</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;mecagp&#39;</span><span class="p">)</span>
        <span class="n">mecagp_pd</span> <span class="o">=</span> <span class="n">InitMecaGpToVTK</span><span class="p">(</span><span class="n">mecagp_field</span><span class="p">)</span>
        <span class="n">dict_fgp</span><span class="p">[</span><span class="s1">&#39;mecagp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mecagp_pd</span><span class="p">,</span> <span class="n">mecagp_field</span><span class="p">)</span>

      <span class="n">with_rigid</span> <span class="o">=</span> <span class="kc">False</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbm</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mecaMAILx_IsRigid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
          <span class="n">with_rigid</span> <span class="o">=</span> <span class="kc">True</span>
          <span class="k">break</span>

      <span class="k">if</span> <span class="n">with_rigid</span> <span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;meca_R&#39;</span><span class="p">)</span>
        <span class="n">meca_R_pd</span> <span class="o">=</span> <span class="n">InitMecaRToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
        <span class="n">dict_fgp</span><span class="p">[</span><span class="s1">&#39;meca_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">meca_R_pd</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">if</span> <span class="n">therMAILx_GetNbTherMAILx</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
      <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;therfe&#39;</span><span class="p">)</span>
      <span class="n">therfe_grid</span> <span class="o">=</span> <span class="n">InitTherFeToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
      <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;therfe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">therfe_grid</span><span class="p">,</span> <span class="p">{})</span>

      <span class="k">if</span> <span class="n">thergp_field</span><span class="p">:</span>
        <span class="n">accept</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gradT&#39;</span><span class="p">,</span> <span class="s1">&#39;fluxT&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thergp_field</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">thergp_field</span> <span class="o">=</span> <span class="p">[</span><span class="n">thergp_field</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">thergp_field</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Unknown thergp_field argument, must be &#39;gradT&#39; or &#39;fluxT&#39; (not &#39;</span><span class="si">{</span><span class="n">tf</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
          <span class="k">assert</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">accept</span><span class="p">,</span> <span class="n">msg</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;thergp&#39;</span><span class="p">)</span>
        <span class="n">thergp_pd</span> <span class="o">=</span> <span class="n">InitTherGpToVTK</span><span class="p">(</span><span class="n">thergp_field</span><span class="p">)</span>
        <span class="n">dict_fgp</span><span class="p">[</span><span class="s1">&#39;thergp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">thergp_pd</span><span class="p">,</span> <span class="n">thergp_field</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">poroMAILx_GetNbPoroMAILx</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
      <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;porofe&#39;</span><span class="p">)</span>
      <span class="n">porofe_grid</span> <span class="o">=</span> <span class="n">InitPoroFeToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
      <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;porofe&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">porofe_grid</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">if</span> <span class="n">multiMAILx_GetNb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
      <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;multife&#39;</span><span class="p">)</span>
      <span class="n">multife_grid</span> <span class="o">=</span> <span class="n">InitMultiFeToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
      <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;multife&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">multife_grid</span><span class="p">,</span> <span class="p">{})</span>

    <span class="k">if</span> <span class="n">DIMENSION</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>

      <span class="n">tact_names</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DISKx&#39;</span><span class="p">,</span> <span class="s1">&#39;DISKx&#39;</span><span class="p">,</span> <span class="s1">&#39;JONCx&#39;</span><span class="p">,</span> <span class="s1">&#39;POLYG&#39;</span><span class="p">,</span> <span class="s1">&#39;PT2Dx&#39;</span><span class="p">,</span> <span class="s1">&#39;xKSID&#39;</span><span class="p">]</span>

      <span class="k">if</span> <span class="n">RBDY2_GetNbRBDY2</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rigids&#39;</span><span class="p">)</span>
        <span class="n">rigids_grid</span> <span class="o">=</span> <span class="n">InitRigidsToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;rigids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rigids_grid</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tacts&#39;</span><span class="p">)</span>
        <span class="n">InitTactorsToVTK</span><span class="p">(</span><span class="n">tact_names</span><span class="p">,</span><span class="n">tacts_dict</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;tacts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tacts_dict</span><span class="p">,</span> <span class="p">{})</span>

      <span class="k">elif</span> <span class="n">MBS2D_getNb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tacts&#39;</span><span class="p">)</span>
        <span class="n">InitTactorsToVTK</span><span class="p">(</span><span class="n">tact_names</span><span class="p">,</span><span class="n">tacts_dict</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;tacts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tacts_dict</span><span class="p">,</span> <span class="p">{})</span>


    <span class="k">elif</span> <span class="n">DIMENSION</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>

      <span class="n">tact_names</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SPHER&#39;</span><span class="p">,</span> <span class="s1">&#39;POLYR&#39;</span><span class="p">,</span> <span class="s1">&#39;PLANx&#39;</span><span class="p">,</span> <span class="s1">&#39;CYLND&#39;</span><span class="p">,</span> <span class="s1">&#39;DNLYC&#39;</span><span class="p">,</span> <span class="s1">&#39;PT3Dx&#39;</span><span class="p">]</span>

      <span class="k">if</span> <span class="n">RBDY3_GetNbRBDY3</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rigids&#39;</span><span class="p">)</span>
        <span class="n">rigids_grid</span> <span class="o">=</span> <span class="n">InitRigidsToVTK</span><span class="p">(</span><span class="n">DIMENSION</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;rigids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rigids_grid</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tacts&#39;</span><span class="p">)</span>
        <span class="n">InitTactorsToVTK</span><span class="p">(</span><span class="n">tact_names</span><span class="p">,</span><span class="n">tacts_dict</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;tacts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tacts_dict</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">if</span> <span class="s1">&#39;POLYR&#39;</span> <span class="ow">in</span> <span class="n">tacts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">writePolyrToVTK</span><span class="p">(</span><span class="n">wd</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="o">/</span><span class="s1">&#39;polyr.vtu&#39;</span><span class="p">,</span> <span class="n">tacts_dict</span><span class="p">[</span><span class="s1">&#39;POLYR&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

      <span class="k">elif</span> <span class="n">MBS3D_getNb</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;tacts&#39;</span><span class="p">)</span>
        <span class="n">InitTactorsToVTK</span><span class="p">(</span><span class="n">tact_names</span><span class="p">,</span><span class="n">tacts_dict</span><span class="p">)</span>
        <span class="n">dict_fid</span><span class="p">[</span><span class="s1">&#39;tacts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tacts_dict</span><span class="p">,</span> <span class="p">{})</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># to write polyr.vtu when there are only POLYD</span>
        <span class="n">InitTactorsToVTK</span><span class="p">([</span><span class="s1">&#39;POLYR&#39;</span><span class="p">],</span><span class="n">tacts_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;POLYR&#39;</span> <span class="ow">in</span> <span class="n">tacts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="n">writePolyrToVTK</span><span class="p">(</span><span class="n">wd</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="o">/</span><span class="s1">&#39;polyr.vtu&#39;</span><span class="p">,</span> <span class="n">tacts_dict</span><span class="p">[</span><span class="s1">&#39;POLYR&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">else</span> <span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:OpenDisplayFiles] must be called after SetDimension&#39;</span> <span class="p">)</span>
      <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="k">if</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>

      <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">write_f2f</span><span class="p">:</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Face2Face&#39;</span><span class="p">)</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;PressureCenter&#39;</span><span class="p">)</span>
        <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ContactPointContour&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">write_f2f</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
          <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CentralKernel&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">write_f2f</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">vblock_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;CompressionStress&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vblock_list</span><span class="p">:</span>
      <span class="n">fname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="o">/</span><span class="sa">f</span><span class="s2">&quot;lmgc90.pvd&quot;</span>
      <span class="n">fvtk</span>  <span class="o">=</span> <span class="n">startCollection</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">wdf</span><span class="p">)</span></div>


<div class="viewcode-block" id="WriteDisplayFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteDisplayFiles">[docs]</a><span class="k">def</span> <span class="nf">WriteDisplayFiles</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ref_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normal_orient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_gp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write visualization files if current time step number is a multiple of freq in DISPLAY directory.</span>

<span class="sd">  Parameters:</span>

<span class="sd">  - freq (int)       : manages the occurence of file creation</span>

<span class="sd">  Optional arguments are a tuple to add external fields to visualize in case a VTK.</span>

<span class="sd">  Deprecated: the arguments &#39;ref_radius&#39;, &#39;normal_orient&#39; and &#39;write_gp&#39; are now useless and will be removed in a future release</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">dict_fid</span><span class="p">,</span> <span class="n">dict_fgp</span><span class="p">,</span> <span class="n">wdf</span><span class="p">,</span> <span class="n">tacts_dict</span><span class="p">,</span> <span class="n">inters_list</span><span class="p">,</span> <span class="n">registers2display</span><span class="p">,</span> <span class="n">inter_mapper</span><span class="p">,</span> <span class="n">fvtk</span><span class="p">,</span> <span class="n">vblock_list</span>

  <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">is_vtk_display</span> <span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[WARNING:WriteDisplayfiles] Since vtk module is not available this function does nothing&#39;</span> <span class="p">)</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="n">TimeEvolution_GetStep</span><span class="p">()</span><span class="o">%</span><span class="n">freq</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>

    <span class="n">wdf</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">wd</span> <span class="o">=</span> <span class="n">overall_GetWorkingDirectory</span><span class="p">()</span>

    <span class="c1"># reset user fields</span>
    <span class="n">ufields</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="c1"># to check for deprecated arguments:</span>
    <span class="n">depre</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ref_radius&#39;</span><span class="p">,</span> <span class="s1">&#39;normal_orient&#39;</span><span class="p">,</span> <span class="s1">&#39;write_gp&#39;</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;[WARNING:WriteDisplayFiles] &#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&#39; parameter is now useless.</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">28</span><span class="si">}</span><span class="s2">Please remove it since this will raise an error in a later release&quot;</span>
    <span class="c1"># check for deprecated arguments</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">depre</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">eval</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="n">msg</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">)</span>

    <span class="c1"># sort user fields depending on block</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;[WARNING:WriteDisplayFiles] &#39;</span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; block not in list of written blocks&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CompressionStress&#39;</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;[WARNING:WriteDisplayFiles] &#39;</span><span class="si">{</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39; block does not handle user field yet&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># beurk...</span>
          <span class="k">if</span> <span class="s1">&#39;fe&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">ufields</span><span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">ufields</span><span class="p">[</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">fvtk</span><span class="p">:</span>

      <span class="n">fname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;DISPLAY&#39;</span><span class="o">/</span><span class="sa">f</span><span class="s2">&quot;lmgc90_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">wdf</span><span class="p">)</span><span class="si">}</span><span class="s2">.vtmb&quot;</span>
      <span class="n">vtk_blocks</span> <span class="o">=</span> <span class="n">getVtkBlockFile</span><span class="p">(</span><span class="n">vblock_list</span><span class="p">)</span>

      <span class="c1"># write all type of block</span>
      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fid</span> <span class="ow">in</span> <span class="n">dict_fid</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
          <span class="k">continue</span>
        <span class="n">i_block</span> <span class="o">=</span> <span class="n">vblock_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">writeToBlock</span><span class="p">(</span> <span class="n">vtk_blocks</span><span class="p">,</span> <span class="n">i_block</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">fid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">fid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">ufields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>

      <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fgp</span> <span class="ow">in</span> <span class="n">dict_fgp</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
          <span class="k">continue</span>
        <span class="n">i_block</span> <span class="o">=</span> <span class="n">vblock_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">writeGpdToBlock</span><span class="p">(</span> <span class="n">vtk_blocks</span><span class="p">,</span> <span class="n">i_block</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">fgp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fgp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">ufields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;ptc&#39;</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>

        <span class="n">inters</span> <span class="o">=</span> <span class="n">getInteractions</span><span class="p">(</span><span class="n">human</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># get the register</span>
        <span class="n">register_opt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">registers2display</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">inter_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">internals</span> <span class="o">=</span> <span class="n">getInternalArray</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">inters</span><span class="p">)</span>
            <span class="n">register_opt</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">internals</span>

        <span class="n">i_block</span> <span class="o">=</span> <span class="n">vblock_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;ptc&#39;</span><span class="p">)</span>
        <span class="n">writeIntersToBlock</span><span class="p">(</span> <span class="n">vtk_blocks</span><span class="p">,</span> <span class="n">i_block</span><span class="p">,</span> <span class="n">inters</span><span class="p">,</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="o">**</span><span class="n">register_opt</span><span class="p">,</span> <span class="o">**</span><span class="n">ufields</span><span class="p">[</span><span class="s1">&#39;ptc&#39;</span><span class="p">]</span> <span class="p">)</span>

      <span class="k">if</span> <span class="s1">&#39;Face2Face&#39;</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
        <span class="c1"># there is room for debate here...</span>
        <span class="c1"># in other writeXXXBlocks function, the function itself call the accessor,</span>
        <span class="c1"># whereas here, the data are provided in input.</span>
        <span class="c1"># it would be possible to move these GetF2f thingy inside the display module...</span>

        <span class="n">f2f_connec</span><span class="p">,</span> <span class="n">f2f_coor</span> <span class="o">=</span> <span class="n">PRPRx_GetF2fOutlines</span><span class="p">()</span>
        <span class="n">f2f_inters</span> <span class="o">=</span> <span class="n">PRPRx_GetF2f2Inters</span><span class="p">()</span>
        <span class="n">idx_prprx</span> <span class="o">=</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;inter&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">PRPRx_ID</span>
        <span class="n">prprx_inters</span> <span class="o">=</span> <span class="n">inters</span><span class="p">[</span><span class="n">idx_prprx</span><span class="p">]</span>

        <span class="n">i_block</span> <span class="o">=</span> <span class="n">vblock_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Face2Face&#39;</span><span class="p">)</span>
        <span class="c1"># contrary to other writeXXXToBlock, there are 3 blocks written here</span>
        <span class="c1"># thus the ufields dict cannot be used in the same way to provide optional arguments</span>
        <span class="c1"># so the dictionnary are provided one by one... especially if one hopes to</span>
        <span class="c1"># add the same named field to each block</span>
        <span class="n">addF2fToVtkBlocks</span><span class="p">(</span><span class="n">vtk_blocks</span><span class="p">,</span> <span class="n">i_block</span><span class="p">,</span> <span class="n">f2f_connec</span><span class="p">,</span> <span class="n">f2f_coor</span><span class="p">,</span> <span class="n">f2f_inters</span><span class="p">,</span> <span class="n">prprx_inters</span><span class="p">,</span>
                          <span class="n">ufields</span><span class="p">[</span><span class="s1">&#39;Face2Face&#39;</span><span class="p">],</span> <span class="n">ufields</span><span class="p">[</span><span class="s1">&#39;PressureCenter&#39;</span><span class="p">],</span> <span class="n">ufields</span><span class="p">[</span><span class="s1">&#39;ContactPointContour&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s1">&#39;CentralKernel&#39;</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
          <span class="n">i_block</span> <span class="o">=</span> <span class="n">vblock_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;CentralKernel&#39;</span><span class="p">)</span>
          <span class="n">nb_f2f</span> <span class="o">=</span> <span class="n">PRPRx_GetNbF2f</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
          <span class="n">ck_list</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="k">for</span> <span class="n">i_f2f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nb_f2f</span><span class="p">):</span>
            <span class="c1">#ck = central_kernel.get(f2f_connec, f2f_coor, f2f_inters, prprx_inters)</span>
            <span class="n">ck</span> <span class="o">=</span> <span class="n">PRPRx_GetF2fCentralKernel</span><span class="p">(</span><span class="n">i_f2f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ck</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
              <span class="k">continue</span>
            <span class="n">ck</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_f2f</span><span class="p">)</span>
            <span class="n">ck_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="p">)</span>
          <span class="n">f2f_stress</span> <span class="o">=</span> <span class="kc">None</span>
          <span class="k">if</span> <span class="s1">&#39;CompressionStress&#39;</span> <span class="ow">in</span> <span class="n">vblock_list</span><span class="p">:</span>
            <span class="n">f2f_stress</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i_f2f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nb_f2f</span><span class="p">):</span>
              <span class="n">data</span> <span class="o">=</span> <span class="n">PRPRx_GetF2fStress</span><span class="p">(</span><span class="n">i_f2f</span><span class="p">)</span>
              <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_f2f</span><span class="p">)</span>
              <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f2f_stress</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
              <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">99.</span><span class="p">:</span>
                <span class="n">f2f_stress</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
          <span class="c1"># paranoid ?</span>
          <span class="c1">#assert len(ck) == len(f2f_stress), &#39;error when getting f2f stress&#39;</span>
          <span class="n">central_kernel</span><span class="o">.</span><span class="n">addCkToVtkBlocks</span><span class="p">(</span><span class="n">vtk_blocks</span><span class="p">,</span> <span class="n">i_block</span><span class="p">,</span> <span class="n">ck_list</span><span class="p">,</span> <span class="n">f2f_stress</span><span class="p">,</span> <span class="n">ufields</span><span class="p">[</span><span class="s1">&#39;CentralKernel&#39;</span><span class="p">])</span>

      <span class="n">writeBlocksToVTK</span><span class="p">(</span> <span class="n">fvtk</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">vtk_blocks</span> <span class="p">)</span></div>

<div class="viewcode-block" id="OpenPostproFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.OpenPostproFiles">[docs]</a><span class="k">def</span> <span class="nf">OpenPostproFiles</span><span class="p">(</span><span class="n">restart</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Initialize post processing files writing.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">postpro_PostproBeforeComputation</span><span class="p">(</span> <span class="n">restart</span> <span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">postpro_3D_PostproBeforeComputation</span><span class="p">(</span> <span class="n">restart</span> <span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:OpenPostproFiles] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="CloseDisplayFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.CloseDisplayFiles">[docs]</a><span class="k">def</span> <span class="nf">CloseDisplayFiles</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Used to close containers of visualization files (*.pvd).</span>
<span class="sd">     But no need anymore</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">pass</span></div>

<div class="viewcode-block" id="WritePostproFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WritePostproFiles">[docs]</a><span class="k">def</span> <span class="nf">WritePostproFiles</span><span class="p">(</span><span class="n">force_flush</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write post processing files (POSTPRO/*.OUT).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">postpro_PostproDuringComputation</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">force_flush</span><span class="p">:</span>
        <span class="n">postpro_FlushDuringComputation</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">postpro_3D_PostproDuringComputation</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">force_flush</span><span class="p">:</span>
        <span class="n">postpro_3D_FlushDuringComputation</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WritePostproFiles] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="ClosePostproFiles"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ClosePostproFiles">[docs]</a><span class="k">def</span> <span class="nf">ClosePostproFiles</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Close post processing files.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">postpro_ClosePostproFiles</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">postpro_3D_ClosePostproFiles</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ClosePostproFiles] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="WriteOutGPV"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOutGPV">[docs]</a><span class="k">def</span> <span class="nf">WriteOutGPV</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write current Gauss points values of all meshes (OUTBOX/GPV.x.OUT)</span>
<span class="sd">  if current time step number is a multiple of nsteps.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">TimeEvolution_WriteOutGPV</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
  <span class="n">MAILx_WriteOutGPV</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteOutMpValues"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOutMpValues">[docs]</a><span class="k">def</span> <span class="nf">WriteOutMpValues</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write multi-physics data at current time step in ascii file(s).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteOutMpValues</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">mp_solver_WriteOutMpValues</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">mp_solver_3D_WriteOutMpValues</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteOutMpValues] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="WriteOutRnod"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOutRnod">[docs]</a><span class="k">def</span> <span class="nf">WriteOutRnod</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write current values of reaction for each bodies if current time step number</span>
<span class="sd">  is a multiple of nsteps.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="n">TimeEvolution_WriteOutRnod</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">RBDY2_WriteOutRnod</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">RBDY3_WriteOutRnod</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteOutRnod] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span>
  <span class="n">mecaMAILx_WriteOutRnod</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteOutVlocRloc"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOutVlocRloc">[docs]</a><span class="k">def</span> <span class="nf">WriteOutVlocRloc</span><span class="p">(</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Write values of every interactions if current time step number is a multiple of nsteps.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>

  <span class="c1"># If it is not a step to write Vloc_Rloc, continue</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">TimeEvolution_GetStep</span><span class="p">()</span> <span class="o">%</span> <span class="n">nsteps</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span>

  <span class="n">TimeEvolution_WriteOutVlocRloc</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">CLALp_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">CLJCx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKALp_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKL_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKDKx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKJCx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKKDx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">DKPLx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">P2P2L_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLALp_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLJCx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PLPLx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT2_WriteOutVlocRloc</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">CDCDx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">CDPLx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">CSASp_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRASp_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">CSPRx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRPLx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PRPRx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">PTPT3_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPCDx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPDCx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPPLx_WriteOutVlocRloc</span><span class="p">()</span>
    <span class="n">SPPRx_WriteOutVlocRloc</span><span class="p">()</span>    
    <span class="n">SPSPx_WriteOutVlocRloc</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:WriteOutVlocRloc] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="repack_h5file"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.repack_h5file">[docs]</a><span class="k">def</span> <span class="nf">repack_h5file</span><span class="p">(</span> <span class="n">fname</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    use h5_repack on a HDF5 file to use free unused disk space</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">working_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">overall_GetWorkingDirectory</span><span class="p">())</span>

    <span class="n">realname</span> <span class="o">=</span> <span class="n">working_dir</span><span class="o">/</span><span class="n">fname</span>
    <span class="n">tmpname</span>  <span class="o">=</span> <span class="n">realname</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span> <span class="n">realname</span><span class="o">.</span><span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.tmp&#39;</span> <span class="p">)</span>

    <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;h5repack&quot;</span><span class="p">,</span> <span class="n">realname</span><span class="p">,</span> <span class="n">tmpname</span><span class="p">])</span>
    <span class="n">tmpname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="n">realname</span> <span class="p">)</span></div>


<div class="viewcode-block" id="InitHDF5"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.InitHDF5">[docs]</a><span class="k">def</span> <span class="nf">InitHDF5</span><span class="p">(</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Initialize HDF5 output file (and use h5repack just in case)</span>

<span class="sd">  If no filename given or HDF5 has not been used during compilation</span>
<span class="sd">  this function is ignored and next calls to &#39;WriteOut&#39; function</span>
<span class="sd">  will write ASCII files in OUTBOX directory</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">use_hdf5</span>

  <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
    <span class="n">use_hdf5</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">io_hdf5_initOutFile</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>
    <span class="n">repack_h5file</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>

    <span class="n">use_hdf5</span> <span class="o">=</span> <span class="kc">True</span>

  <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">use_hdf5</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;INFO: You are not able to initialize output file in HDF5 format.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
           <span class="s2">&quot;      To be able to write in HDF5 format, please enable the </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
           <span class="s2">&quot;      WITH_HDF5 flag at the compilation time.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
           <span class="s2">&quot;      Example: cmake -DWITH_HDF5=ON .. &amp;&amp; make -j8&quot;</span> <span class="p">)</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="WriteHDF5"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteHDF5">[docs]</a><span class="k">def</span> <span class="nf">WriteHDF5</span><span class="p">(</span> <span class="n">nsteps</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Write HDF5 output.</span>
<span class="sd">     - DOF (degree of freedom) in 2D and 3D</span>
<span class="sd">     - Vloc_Rloc in 2D and 3D</span>
<span class="sd">     - GPV fields</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># If it is not a step to write Vloc_Rloc, continue</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">TimeEvolution_GetStep</span><span class="p">()</span> <span class="o">%</span> <span class="n">nsteps</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span>

  <span class="n">io_hdf5_write</span><span class="p">(</span> <span class="p">)</span></div>

<div class="viewcode-block" id="WriteOut"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteOut">[docs]</a><span class="k">def</span> <span class="nf">WriteOut</span><span class="p">(</span> <span class="n">nsteps</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Write Out files.</span>
<span class="sd">     If InitHDF5 has been used with a valid filename</span>
<span class="sd">     then it will write in the defined file.</span>
<span class="sd">     Otherwise the ASCII files in OUTBOX directory will</span>
<span class="sd">     be written</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">use_hdf5</span>

  <span class="k">if</span> <span class="n">use_hdf5</span><span class="p">:</span>
    <span class="n">WriteHDF5</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">WriteOutDof</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">MAILx_GetNbMAILx</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">WriteOutGPV</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span>
    <span class="c1"># should check against see_table...</span>
    <span class="k">if</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">WriteOutVlocRloc</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span></div>

<div class="viewcode-block" id="WriteLast"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.WriteLast">[docs]</a><span class="k">def</span> <span class="nf">WriteLast</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Write Last files.</span>
<span class="sd">     If InitHDF5 has been used with a valid filename</span>
<span class="sd">     then it will write in the defined file.</span>
<span class="sd">     Otherwise the ASCII files in OUTBOX directory will</span>
<span class="sd">     be written</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">use_hdf5</span>

  <span class="k">if</span> <span class="n">use_hdf5</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">io_hdf5_write_last</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>
    <span class="n">repack_h5file</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">WriteLastDof</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">MAILx_GetNbMAILx</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">WriteLastGPV</span><span class="p">()</span>
    <span class="c1"># should check against see_table...</span>
    <span class="k">if</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">WriteLastVlocRloc</span><span class="p">()</span></div>


<div class="viewcode-block" id="ReadDatbox"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ReadDatbox">[docs]</a><span class="k">def</span> <span class="nf">ReadDatbox</span><span class="p">(</span><span class="n">deformable</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Read all .DAT and .INI files from DATBOX directory</span>
<span class="sd">   to initialize LMGC90 database.</span>
<span class="sd">   &quot;&quot;&quot;</span>

  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ BEHAVIOURS&#39;</span><span class="p">)</span>
  <span class="n">ReadBehaviours</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">deformable</span><span class="p">:</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ MODELS&#39;</span><span class="p">)</span>
      <span class="n">ReadModels</span><span class="p">()</span>

  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ BODIES&#39;</span><span class="p">)</span>
  <span class="n">ReadBodies</span><span class="p">()</span>

  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ BEHAVIOURS&#39;</span><span class="p">)</span>
  <span class="n">LoadBehaviours</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">deformable</span><span class="p">:</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;LOAD MODELS&#39;</span><span class="p">)</span>
      <span class="n">LoadModels</span><span class="p">()</span>

  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ INI DOF&#39;</span><span class="p">)</span>
  <span class="n">ReadIniDof</span><span class="p">()</span>
  <span class="c1">#</span>
  <span class="k">if</span> <span class="n">deformable</span><span class="p">:</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ INI GPV&#39;</span><span class="p">)</span>
      <span class="n">ReadIniGPV</span><span class="p">()</span>
  <span class="c1">#</span>
  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ DRIVEN DOF&#39;</span><span class="p">)</span>
  <span class="n">ReadDrivenDof</span><span class="p">()</span>
  <span class="c1">#</span>
  <span class="k">if</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;LOAD TACTORS&#39;</span><span class="p">)</span>
      <span class="n">LoadTactors</span><span class="p">()</span>
      <span class="c1">#</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;READ INI Vloc Rloc&#39;</span><span class="p">)</span>
      <span class="n">ReadIniVlocRloc</span><span class="p">()</span>

  <span class="c1">#</span>
  <span class="c1"># paranoid writes</span>
  <span class="c1">#</span>
  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;WRITE BODIES&#39;</span><span class="p">)</span>
  <span class="n">WriteBodies</span><span class="p">()</span>
  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;WRITE DRIVEN DOF&#39;</span><span class="p">)</span>
  <span class="n">WriteDrivenDof</span><span class="p">()</span>
  <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;WRITE BEHAVIOURS&#39;</span><span class="p">)</span>
  <span class="n">WriteBehaviours</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">deformable</span><span class="p">:</span>
      <span class="n">utilities_logMes</span><span class="p">(</span><span class="s1">&#39;WRITE MODELS&#39;</span><span class="p">)</span>
      <span class="n">models_WriteModels</span><span class="p">()</span></div>


<div class="viewcode-block" id="ExSolver"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.ExSolver">[docs]</a><span class="k">def</span> <span class="nf">ExSolver</span><span class="p">(</span><span class="n">stype</span><span class="p">,</span><span class="n">norm</span><span class="p">,</span><span class="n">conv</span><span class="p">,</span><span class="n">relax</span><span class="p">,</span><span class="n">gsit1</span><span class="p">,</span><span class="n">gsit2</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Run Non-linear Gauss Seidel contact solver.</span>

<span class="sd">  parameters:</span>

<span class="sd">  - stype: type of solver (&#39;Exchange Local Global&#39; or &#39;Stored_Delassus_Loops&#39;).</span>
<span class="sd">  - norm: type of norm (&#39;Quad&#39;, &#39;QM/16&#39;, &#39;Maxm&#39;).</span>
<span class="sd">  - conv: convergence tolerance demanded.</span>
<span class="sd">  - relax: relaxation parameter.</span>
<span class="sd">  - gsit1: maximum number of convergence check before stopping.</span>
<span class="sd">  - gsit2: number of iterations of nlgs before checking convergence.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">nlgs_ExSolver</span><span class="p">(</span><span class="n">stype</span><span class="p">,</span><span class="n">norm</span><span class="p">,</span><span class="n">conv</span><span class="p">,</span><span class="n">relax</span><span class="p">,</span><span class="n">gsit1</span><span class="p">,</span><span class="n">gsit2</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">nlgs_3D_ExSolver</span><span class="p">(</span><span class="n">stype</span><span class="p">,</span><span class="n">norm</span><span class="p">,</span><span class="n">conv</span><span class="p">,</span><span class="n">relax</span><span class="p">,</span><span class="n">gsit1</span><span class="p">,</span><span class="n">gsit2</span><span class="p">)</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:ExSolver] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="UpdateTactBehav"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.UpdateTactBehav">[docs]</a><span class="k">def</span> <span class="nf">UpdateTactBehav</span><span class="p">():</span>
  <span class="sd">&quot;&quot;&quot;Updates internal variables of interactions.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span>
  <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">nlgs_UpdateTactBehav</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">nlgs_3D_UpdateTactBehav</span><span class="p">()</span>
  <span class="k">else</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:UpdateTactBehav] must be called after SetDimension&#39;</span> <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">ValueError</span></div>


<div class="viewcode-block" id="checkDirectories"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.checkDirectories">[docs]</a><span class="k">def</span> <span class="nf">checkDirectories</span><span class="p">(</span><span class="n">checkDATBOX</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Check if DATBOX directory exists (if not, it stops).</span>
<span class="sd">  Create OUTBOX, POSTPRO and/or DISPLAY directory if one</span>
<span class="sd">  does not exists.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">working_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">overall_GetWorkingDirectory</span><span class="p">())</span>
  <span class="n">datbox</span> <span class="o">=</span> <span class="n">working_dir</span><span class="o">/</span><span class="s1">&#39;DATBOX&#39;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">checkDATBOX</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">datbox</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DATBOX directory is not present&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OUTBOX&#39;</span><span class="p">,</span> <span class="s1">&#39;POSTPRO&#39;</span><span class="p">,</span> <span class="s1">&#39;DISPLAY&#39;</span><span class="p">]:</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">working_dir</span><span class="o">/</span><span class="n">d</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dp</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> directory for you...&quot;</span><span class="p">)</span>
      <span class="n">dp</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span></div>


<div class="viewcode-block" id="checkInteractiveCommand"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.checkInteractiveCommand">[docs]</a><span class="k">def</span> <span class="nf">checkInteractiveCommand</span><span class="p">(</span><span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;last.h5&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Check if some specific files exist and react depending on the result:</span>

<span class="sd">  - file &#39;stop&#39;: write every possible .OUT files and exit.</span>
<span class="sd">  - file &#39;save&#39;: write every possible .LAST files (or an hdf5 file if last_name is provided).</span>
<span class="sd">  - file &#39;display_now&#39;: write every possible visualization files.</span>
<span class="sd">  - file &#39;flush&#39;: write content of opened postpro files</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">use_hdf5</span>

  <span class="n">wdp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span> <span class="n">overall_GetWorkingDirectory</span><span class="p">()</span> <span class="p">)</span>
  <span class="n">stop_file</span> <span class="o">=</span> <span class="n">wdp</span><span class="o">/</span><span class="s1">&#39;stop&#39;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">stop_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="p">):</span>

    <span class="n">WriteOut</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">WriteOutMpValues</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">WriteDisplayFiles</span><span class="p">()</span>
    <span class="n">CloseDisplayFiles</span><span class="p">()</span>
    <span class="n">WritePostproFiles</span><span class="p">()</span>
    <span class="n">ClosePostproFiles</span><span class="p">()</span>
    <span class="n">Finalize</span><span class="p">()</span>
    <span class="n">stop_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Forced stop computation&#39;</span><span class="p">)</span>

  <span class="n">save_file</span> <span class="o">=</span> <span class="n">wdp</span><span class="o">/</span><span class="s1">&#39;save&#39;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">save_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="p">):</span>

    <span class="n">WriteLast</span><span class="p">(</span><span class="n">last_name</span><span class="p">)</span>
    <span class="n">WriteLastMpValues</span><span class="p">()</span>

    <span class="n">WritePostproFiles</span><span class="p">()</span>
    <span class="n">save_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

  <span class="n">disp_file</span> <span class="o">=</span> <span class="n">wdp</span><span class="o">/</span><span class="s1">&#39;display_now&#39;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">disp_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="p">):</span>
    <span class="n">WriteDisplayFiles</span><span class="p">()</span>
    <span class="n">disp_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

  <span class="n">flush_file</span> <span class="o">=</span> <span class="n">wdp</span><span class="o">/</span><span class="s1">&#39;flush&#39;</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">flush_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">postpro_FlushDuringComputation</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">postpro_3D_FlushDuringComputation</span><span class="p">()</span>
    <span class="n">flush_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span></div>


<div class="viewcode-block" id="getInteractions"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.getInteractions">[docs]</a><span class="k">def</span> <span class="nf">getInteractions</span><span class="p">(</span><span class="n">this</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">human</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Get all interactions as a numpy array with predefined dtype.</span>

<span class="sd">  Must be called after: &#39;Intialize&#39;, &#39;SetDimension&#39; and &#39;ReadBehaviours&#39;</span>

<span class="sd">  By default, get verlet interactions, to get &#39;this&#39; interaction, change</span>
<span class="sd">  the eponym parameter to True.</span>

<span class="sd">  By default, remap parameters id to name and contact law id to its</span>
<span class="sd">  corresponding name. To keep integer values change &#39;human&#39; argument</span>
<span class="sd">  to False.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">get_mdl</span><span class="p">,</span> <span class="n">get_tac</span><span class="p">,</span> <span class="n">get_sta</span><span class="p">,</span> <span class="n">get_int</span><span class="p">,</span> <span class="n">get_law</span><span class="p">,</span> <span class="n">inter_dtype</span><span class="p">,</span> <span class="n">inter_itype</span>

  <span class="n">dim</span> <span class="o">=</span> <span class="n">DIMENSION</span>

  <span class="n">max_int</span> <span class="o">=</span> <span class="n">overall_GetMaxInternalTact</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">rsize</span> <span class="o">=</span> <span class="mi">11</span>
      <span class="k">if</span> <span class="n">this</span><span class="p">:</span>
          <span class="n">get_nb</span>    <span class="o">=</span> <span class="n">inter_handler_2D_tgetNb</span>
          <span class="n">get_idata</span> <span class="o">=</span> <span class="n">inter_handler_2D_tgetIData</span>
          <span class="n">get_rdata</span> <span class="o">=</span> <span class="n">inter_handler_2D_tgetRData</span>
          <span class="n">get_intern</span><span class="o">=</span> <span class="n">inter_handler_2D_tgetInternal</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">get_nb</span>    <span class="o">=</span> <span class="n">inter_handler_2D_getNb</span>
          <span class="n">get_idata</span> <span class="o">=</span> <span class="n">inter_handler_2D_getAllIdata</span>
          <span class="n">get_rdata</span> <span class="o">=</span> <span class="n">inter_handler_2D_getAll</span>
          <span class="n">get_intern</span><span class="o">=</span> <span class="n">inter_handler_2D_getAllInternal</span>
  <span class="k">elif</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">rsize</span> <span class="o">=</span> <span class="mi">19</span>
      <span class="k">if</span> <span class="n">this</span><span class="p">:</span>
          <span class="n">get_nb</span>    <span class="o">=</span> <span class="n">inter_handler_3D_tgetNb</span>
          <span class="n">get_idata</span> <span class="o">=</span> <span class="n">inter_handler_3D_tgetIData</span>
          <span class="n">get_rdata</span> <span class="o">=</span> <span class="n">inter_handler_3D_tgetRData</span>
          <span class="n">get_intern</span><span class="o">=</span> <span class="n">inter_handler_3D_tgetInternal</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">get_nb</span>    <span class="o">=</span> <span class="n">inter_handler_3D_getNb</span>
          <span class="n">get_idata</span> <span class="o">=</span> <span class="n">inter_handler_3D_getAllIdata</span>
          <span class="n">get_rdata</span> <span class="o">=</span> <span class="n">inter_handler_3D_getAll</span>
          <span class="n">get_intern</span><span class="o">=</span> <span class="n">inter_handler_3D_getAllInternal</span>

  <span class="k">else</span> <span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:getInteraction] must be called after SetDimension&#39;</span> <span class="p">)</span>
      <span class="k">raise</span> <span class="ne">ValueError</span>

  <span class="n">isize</span> <span class="o">=</span> <span class="mi">13</span>

  <span class="n">nb_inter</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">(</span> <span class="n">get_nb</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span> <span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="n">inters_list</span> <span class="p">)</span> <span class="p">)</span>

  <span class="k">if</span> <span class="n">human</span><span class="p">:</span>
      <span class="n">i2int</span> <span class="o">=</span> <span class="n">get_int</span>
      <span class="n">i2mdl</span> <span class="o">=</span> <span class="n">get_mdl</span>
      <span class="n">i2tac</span> <span class="o">=</span> <span class="n">get_tac</span>
      <span class="n">i2law</span> <span class="o">=</span> <span class="n">get_law</span>
      <span class="n">i2sta</span> <span class="o">=</span> <span class="n">get_sta</span>
      <span class="n">inters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">nb_inter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">inter_dtype</span> <span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
      <span class="n">i2int</span> <span class="o">=</span> <span class="n">i2mdl</span> <span class="o">=</span> <span class="n">i2tac</span> <span class="o">=</span> <span class="n">i2law</span> <span class="o">=</span> <span class="n">i2sta</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span>
      <span class="n">inters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="n">nb_inter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">inter_itype</span> <span class="p">)</span>

  <span class="n">iid</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">inter_id</span> <span class="ow">in</span> <span class="n">inters_list</span><span class="p">:</span>

      <span class="n">nb_i</span>  <span class="o">=</span> <span class="n">get_nb</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">nb_i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">continue</span>

      <span class="k">if</span> <span class="n">this</span><span class="p">:</span>
          <span class="n">idata</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="p">[</span><span class="n">nb_i</span><span class="p">,</span>  <span class="n">isize</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span>  <span class="p">)</span>
          <span class="n">rdata</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="p">[</span><span class="n">nb_i</span><span class="p">,</span>  <span class="n">rsize</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
          <span class="n">internals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span> <span class="p">[</span><span class="n">nb_i</span><span class="p">,</span><span class="n">max_int</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">iinter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_i</span><span class="p">):</span>
            <span class="n">idata</span><span class="p">[</span><span class="n">iinter</span><span class="p">]</span>     <span class="o">=</span> <span class="n">get_idata</span><span class="p">(</span><span class="n">inter_id</span> <span class="p">,</span> <span class="n">iinter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rdata</span><span class="p">[</span><span class="n">iinter</span><span class="p">]</span>     <span class="o">=</span> <span class="n">get_rdata</span><span class="p">(</span><span class="n">inter_id</span> <span class="p">,</span> <span class="n">iinter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">internals</span><span class="p">[</span><span class="n">iinter</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_intern</span><span class="p">(</span><span class="n">inter_id</span><span class="p">,</span> <span class="n">iinter</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">idata</span>     <span class="o">=</span> <span class="n">get_idata</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
          <span class="n">rdata</span>     <span class="o">=</span> <span class="n">get_rdata</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
          <span class="n">internals</span> <span class="o">=</span> <span class="n">get_intern</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>

      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;inter&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2int</span><span class="p">(</span><span class="n">inter_id</span><span class="p">)</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;icdan&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nb_i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;cdbdy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2mdl</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;anbdy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2mdl</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;icdbdy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;ianbdy&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;cdtac&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2tac</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">4</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;antac&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2tac</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">5</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;icdtac&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;iantac&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;icdsci&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;iansci&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">]</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span> <span class="s1">&#39;behav&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2law</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">i2sta</span><span class="p">(</span><span class="n">idata</span><span class="p">[:,</span><span class="mi">11</span><span class="p">])</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;nb_int&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">idata</span><span class="p">[:,</span><span class="mi">12</span><span class="p">]</span>

      <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;coor&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;uc&#39;</span><span class="p">][</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;uc&#39;</span><span class="p">][</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;uc&#39;</span><span class="p">][</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;rl&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;vl&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="n">dim</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="n">dim</span>
      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;gapTT&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">rdata</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
      <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>

      <span class="n">inters</span><span class="p">[</span><span class="n">iid</span><span class="p">:</span><span class="n">iid</span><span class="o">+</span><span class="n">nb_i</span><span class="p">][</span><span class="s1">&#39;internals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">internals</span>
      <span class="n">iid</span> <span class="o">+=</span> <span class="n">nb_i</span>

  <span class="k">if</span> <span class="n">this</span><span class="p">:</span>
      <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;rl&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">TimeEvolution_GetTimeStep</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">inters</span></div>


<div class="viewcode-block" id="registerInterInternals"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.registerInterInternals">[docs]</a><span class="k">def</span> <span class="nf">registerInterInternals</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register an interaction internal fields.</span>

<span class="sd">    Store a mapping function (numpy vectorized) allowing</span>
<span class="sd">    to get for a given contact law name, the corresponding</span>
<span class="sd">    index (starting with 0) in the internals array.</span>

<span class="sd">    If there is no contact law using the input fields,</span>
<span class="sd">    the field is still registered but nothing will be done.</span>

<span class="sd">    Must be called after: ReadBehaviours.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fields : string or list of string</span>
<span class="sd">             The name(s) of the internal(s) to register.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">inter_mapper</span>

    <span class="c1"># if single field convert to list anyway</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">fields</span><span class="p">,]</span>

    <span class="c1"># register all fields</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
        <span class="n">law2internal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ilaw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tact_behav_GetNbTactBehav</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">law_type</span><span class="p">,</span> <span class="n">law_name</span><span class="p">,</span> <span class="n">law_params</span> <span class="o">=</span> <span class="n">tact_behav_GetTactBehav</span><span class="p">(</span><span class="n">ilaw</span><span class="p">)</span>
          <span class="n">law</span> <span class="o">=</span> <span class="n">law_name</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
          <span class="n">internal_names</span> <span class="o">=</span> <span class="n">tact_behav_GetInternalComment</span><span class="p">(</span><span class="n">ilaw</span><span class="p">)</span>
          <span class="n">internal_names</span> <span class="o">=</span> <span class="n">internal_names</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="c1"># in case field is not available, use -1, which is accessible but identifiable as wrong</span>
          <span class="n">law2internal</span><span class="p">[</span><span class="n">law</span><span class="p">]</span> <span class="o">=</span> <span class="n">internal_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">internal_names</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># if the field is not available for any law, do not create mapper</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">law2internal</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
          <span class="n">l2i_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span> <span class="n">law2internal</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">l2i_index</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">inter_mapper</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">l2i_index</span></div>

<span class="c1"># so ugly...</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;</span> <span class="s1">&#39;1.15.0&#39;</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">_take_along_axis</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="n">new_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">idx</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_arr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">_take_along_axis</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">idx</span> <span class="p">]</span>


<div class="viewcode-block" id="getInternalArray"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.getInternalArray">[docs]</a><span class="k">def</span> <span class="nf">getInternalArray</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">inters</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the internal field as an array.</span>

<span class="sd">    If the field as not been registered with `registerInterInternals`</span>
<span class="sd">    beforehand, it is automatically registered.</span>

<span class="sd">    A default value is needed because in case of mixed contact laws,</span>
<span class="sd">    the desired field may not be defined everywhere.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    field : string</span>
<span class="sd">            The name of the internal field to get</span>
<span class="sd">    inters : numpy array</span>
<span class="sd">             The interaction numpy array from which to extract internal</span>
<span class="sd">    default : float</span>
<span class="sd">              The default value when the internal field is undefined (0.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">get_law</span><span class="p">,</span> <span class="n">inter_mapper</span>

    <span class="c1"># first get the mapper...</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inter_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">registerInterInternals</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="n">mapper</span> <span class="o">=</span> <span class="n">inter_mapper</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
    <span class="c1"># managing trivial case</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mapper</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">inters</span><span class="o">.</span><span class="n">size</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">+</span> <span class="n">default</span>

    <span class="c1"># the mapper always use the byte string, so if the input</span>
    <span class="c1"># inters array provided the id, remapt first:</span>
    <span class="k">if</span> <span class="n">inters</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
      <span class="n">behav</span> <span class="o">=</span> <span class="n">get_law</span><span class="p">(</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">behav</span> <span class="o">=</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span>

    <span class="c1"># map behav to the index to get</span>
    <span class="n">field_idx</span> <span class="o">=</span>  <span class="n">mapper</span><span class="p">(</span><span class="n">behav</span><span class="p">)</span>
    <span class="c1"># extract correct field, if not exist, last value is taken</span>
    <span class="n">internal</span> <span class="o">=</span> <span class="n">_take_along_axis</span><span class="p">(</span><span class="n">inters</span><span class="p">[</span><span class="s1">&#39;internals&#39;</span><span class="p">],</span><span class="n">field_idx</span><span class="p">)</span>
    <span class="c1"># overwrite not available indices with default value</span>
    <span class="n">internal</span><span class="p">[</span><span class="n">field_idx</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>

    <span class="k">return</span> <span class="n">internal</span></div>

<div class="viewcode-block" id="addRegistersToDisplay"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.addRegistersToDisplay">[docs]</a><span class="k">def</span> <span class="nf">addRegistersToDisplay</span><span class="p">(</span><span class="n">to_add</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decide to automatically add registered field to WriteDisplayFiles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    to_add : boolean</span>
<span class="sd">             To enable (default) or disable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">registers2display</span>
    <span class="n">registers2display</span> <span class="o">=</span> <span class="n">to_add</span></div>

<div class="viewcode-block" id="setInternalArray"><a class="viewcode-back" href="../../../chipy_macro.html#pylmgc90.chipy.macro.setInternalArray">[docs]</a><span class="k">def</span> <span class="nf">setInternalArray</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">inters</span><span class="p">,</span> <span class="n">internals</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the internal field in &#39;this&#39; interactions.</span>

<span class="sd">    If the field as not been registered with `registerInterInternals`</span>
<span class="sd">    beforehand, it is automatically registered.</span>

<span class="sd">    Can handle interactions with &#39;human&#39; or &#39;compute id&#39; dtype.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    field : string</span>
<span class="sd">            The name of the internal field to get</span>
<span class="sd">    inters : numpy array</span>
<span class="sd">             The interaction numpy array for which to set the internal</span>
<span class="sd">    internals : numpy array</span>
<span class="sd">                The float array with value of internals (same size than inters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">DIMENSION</span><span class="p">,</span> <span class="n">int_id</span><span class="p">,</span> <span class="n">inter_mapper</span>

    <span class="c1"># first get the mapper...</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inter_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">registerInterInternals</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">inter_mapper</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>

    <span class="c1"># managing trivial case</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mapper</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># get the correct inter_handler</span>
    <span class="k">if</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">handler</span> <span class="o">=</span> <span class="n">inter_handler_2D_tsetInternal</span>
    <span class="k">elif</span> <span class="n">DIMENSION</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">handler</span> <span class="o">=</span> <span class="n">inter_handler_3D_tsetInternal</span>
    <span class="k">else</span> <span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;[ERROR:setInternalArray] must be called after SetDimension&#39;</span> <span class="p">)</span>
      <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="c1"># in case a single internal value provided for the array</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">internals</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,)):</span>
        <span class="n">internals</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span> <span class="p">(</span><span class="n">internals</span><span class="p">,)</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[ERROR:chipy.setInternalArray] non conforming size of inters (</span><span class="si">{</span><span class="n">inters</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">) and internals (</span><span class="si">{</span><span class="n">internals</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">assert</span> <span class="n">inters</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">internals</span><span class="o">.</span><span class="n">size</span> <span class="p">,</span> <span class="n">msg</span>


    <span class="c1"># the mapper always use the byte string, so if then input</span>
    <span class="c1"># inters array provided the id, remapt first:</span>
    <span class="k">if</span> <span class="n">inters</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
      <span class="n">behavs</span> <span class="o">=</span> <span class="n">get_law</span><span class="p">(</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">behavs</span> <span class="o">=</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;behav&#39;</span><span class="p">]</span>

    <span class="c1"># inter_id is needed</span>
    <span class="k">if</span> <span class="n">inters</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="s1">&#39;inter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
      <span class="n">inter_ids</span> <span class="o">=</span> <span class="n">int_id</span><span class="p">(</span><span class="n">inters</span><span class="p">[</span><span class="s1">&#39;inter&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">inter_ids</span> <span class="o">=</span>  <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;inter&#39;</span><span class="p">]</span>

    <span class="c1"># internal indices</span>
    <span class="n">int_idx</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">behavs</span><span class="p">)</span>

    <span class="n">big_iterator</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">inter_ids</span><span class="p">,</span> <span class="n">inters</span><span class="p">[</span><span class="s1">&#39;icdan&#39;</span><span class="p">],</span> <span class="n">int_idx</span><span class="p">,</span> <span class="n">internals</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">inter_id</span><span class="p">,</span> <span class="n">inter_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">big_iterator</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">continue</span>
      <span class="c1"># int conversion is so ugly... do not forget +1 for C/Fortran</span>
      <span class="n">handler</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">inter_id</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">inter_idx</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">value</span><span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">pylmgc90 2025.rc1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pylmgc90.chipy.macro</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2025, CNRS, UM.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.2.
    </div>
  </body>
</html>